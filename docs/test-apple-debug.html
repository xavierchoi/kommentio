<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apple Login ë””ë²„ê·¸ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f7;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .mode-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #2196f3;
        }
        .test-btn {
            background: #007aff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
        }
        .test-btn:hover {
            background: #0056b3;
        }
        .test-btn-secondary {
            background: #6c757d;
        }
        .test-btn-secondary:hover {
            background: #545b62;
        }
        .log {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            height: 300px;
            overflow-y: auto;
            margin: 20px 0;
            white-space: pre-wrap;
        }
        .current-mode {
            font-weight: bold;
            color: #007aff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ Apple Login ë””ë²„ê·¸ í…ŒìŠ¤íŠ¸</h1>
        
        <div class="mode-info">
            <h3>í˜„ì¬ ëª¨ë“œ: <span class="current-mode" id="current-mode">í™•ì¸ ì¤‘...</span></h3>
            <p id="mode-description">ëª¨ë“œ ì •ë³´ë¥¼ í™•ì¸í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
        </div>
        
        <div>
            <button class="test-btn" onclick="testAppleLogin()">ğŸ Apple ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</button>
            <button class="test-btn test-btn-secondary" onclick="toggleMode()">ğŸ”„ ëª¨ë“œ ì „í™˜ (Mock â†” Production)</button>
            <button class="test-btn test-btn-secondary" onclick="checkCurrentMode()">ğŸ“Š í˜„ì¬ ëª¨ë“œ í™•ì¸</button>
            <button class="test-btn test-btn-secondary" onclick="clearLog()">ğŸ—‘ï¸ ë¡œê·¸ ì§€ìš°ê¸°</button>
        </div>
        
        <div class="log" id="log">í…ŒìŠ¤íŠ¸ ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...\n</div>
        
        <!-- Kommentio ìœ„ì ¯ -->
        <div 
            id="kommentio-widget"
            data-kommentio
            data-site-id="apple-debug-test"
            data-page-url="/apple-debug"
            data-theme="light"
            data-supabase-url=""
            data-supabase-key=""
        ></div>
    </div>

    <script src="kommentio.js"></script>
    
    <script>
        let currentMode = 'mock'; // ê¸°ë³¸ê°’
        
        function log(message) {
            const logEl = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logEl.textContent += `[${time}] ${message}\n`;
            logEl.scrollTop = logEl.scrollHeight;
            console.log(`[${time}] ${message}`);
        }
        
        function clearLog() {
            document.getElementById('log').textContent = 'ë¡œê·¸ ì§€ì›Œì§.\n';
        }
        
        function updateModeDisplay() {
            const modeEl = document.getElementById('current-mode');
            const descEl = document.getElementById('mode-description');
            
            if (currentMode === 'mock') {
                modeEl.textContent = 'Mock ëª¨ë“œ';
                modeEl.style.color = '#ff9500';
                descEl.textContent = 'Mock ëª¨ë“œ: Supabase ì—†ì´ ê°€ìƒ ì‚¬ìš©ìë¡œ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.';
            } else {
                modeEl.textContent = 'Production ëª¨ë“œ';
                modeEl.style.color = '#007aff';
                descEl.textContent = 'Production ëª¨ë“œ: ì‹¤ì œ Supabaseì™€ Apple OAuthë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.';
            }
        }
        
        function toggleMode() {
            log('ğŸ”„ ëª¨ë“œ ì „í™˜ ì‹œì‘...');
            
            try {
                const widget = document.getElementById('kommentio-widget');
                
                if (currentMode === 'mock') {
                    // Mock â†’ Production
                    currentMode = 'production';
                    widget.setAttribute('data-supabase-url', 'https://nwjbtsjeikrwyqltkpqv.supabase.co');
                    widget.setAttribute('data-supabase-key', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im53amJ0c2plaWtyd3lxbHRrcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk1NDA0MDUsImV4cCI6MjA2NTExNjQwNX0.UXNFgCrKfBHrcbenw94v9rD-sbGEE6ENDaF7h01EFPQ');
                    log('âœ… Production ëª¨ë“œë¡œ ì „í™˜ë¨');
                    log('ğŸ”§ Supabase URL: nwjbtsjeikrwyqltkpqv.supabase.co');
                    
                    // URL íŒŒë¼ë¯¸í„°ë¡œ ëª¨ë“œ ì„¤ì •í•˜ì—¬ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                    log('ğŸ”„ Production ëª¨ë“œë¡œ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨...');
                    setTimeout(() => {
                        window.location.href = window.location.pathname + '?mode=production';
                    }, 1000);
                    
                } else {
                    // Production â†’ Mock
                    currentMode = 'mock';
                    widget.setAttribute('data-supabase-url', '');
                    widget.setAttribute('data-supabase-key', '');
                    log('âœ… Mock ëª¨ë“œë¡œ ì „í™˜ë¨');
                    log('ğŸ”§ Supabase ì„¤ì • ì œê±°ë¨');
                    
                    // URL íŒŒë¼ë¯¸í„° ì œê±°í•˜ì—¬ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                    log('ğŸ”„ Mock ëª¨ë“œë¡œ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨...');
                    setTimeout(() => {
                        window.location.href = window.location.pathname;
                    }, 1000);
                }
                
                updateModeDisplay();
                
            } catch (error) {
                log(`âŒ ëª¨ë“œ ì „í™˜ ì—ëŸ¬: ${error.message}`);
                console.error('ëª¨ë“œ ì „í™˜ ì—ëŸ¬:', error);
            }
        }
        
        function checkCurrentMode() {
            log('ğŸ“Š í˜„ì¬ ëª¨ë“œ í™•ì¸ ì¤‘...');
            
            try {
                if (typeof kommentio === 'undefined') {
                    log('âš ï¸ Kommentio ìœ„ì ¯ì´ ì•„ì§ ë¡œë“œë˜ì§€ ì•ŠìŒ');
                    return;
                }
                
                const widget = document.getElementById('kommentio-widget');
                const supabaseUrl = widget.getAttribute('data-supabase-url');
                
                log(`ğŸ”§ Kommentio Mock ëª¨ë“œ: ${kommentio.mockMode}`);
                log(`ğŸ”§ Widget Supabase URL: ${supabaseUrl || '(ì—†ìŒ)'}`);
                log(`ğŸ”§ í˜„ì¬ ì„¤ì • ëª¨ë“œ: ${currentMode}`);
                
                if (kommentio.currentUser) {
                    log(`ğŸ‘¤ í˜„ì¬ ë¡œê·¸ì¸ ì‚¬ìš©ì: ${kommentio.currentUser.email}`);
                } else {
                    log('ğŸ‘¤ í˜„ì¬ ë¡œê·¸ì¸ ì‚¬ìš©ì: ì—†ìŒ');
                }
                
            } catch (error) {
                log(`âŒ ëª¨ë“œ í™•ì¸ ì—ëŸ¬: ${error.message}`);
            }
        }
        
        async function testAppleLogin() {
            log('ğŸ Apple ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            try {
                if (typeof kommentio === 'undefined') {
                    log('âŒ Kommentio ìœ„ì ¯ì´ ë¡œë“œë˜ì§€ ì•ŠìŒ');
                    return;
                }
                
                log(`ğŸ“Š í…ŒìŠ¤íŠ¸ ëª¨ë“œ: ${currentMode}`);
                log(`ğŸ“Š Kommentio Mock ëª¨ë“œ: ${kommentio.mockMode}`);
                
                // Apple ë¡œê·¸ì¸ ì‹¤í–‰
                log('â³ Apple ë¡œê·¸ì¸ ì‹¤í–‰ ì¤‘...');
                await kommentio.login('apple');
                
                log('ğŸ‰ Apple ë¡œê·¸ì¸ ì™„ë£Œ!');
                
                // ì‚¬ìš©ì ì •ë³´ í™•ì¸
                if (kommentio.currentUser) {
                    log(`âœ… ì‚¬ìš©ì ID: ${kommentio.currentUser.id}`);
                    log(`âœ… ì´ë©”ì¼: ${kommentio.currentUser.email}`);
                    log(`âœ… ì´ë¦„: ${kommentio.currentUser.user_metadata?.name}`);
                    log(`âœ… í”„ë¡œë°”ì´ë”: ${kommentio.currentUser.user_metadata?.provider}`);
                    
                    if (kommentio.mockMode) {
                        log('ğŸ­ Mock ëª¨ë“œë¡œ ê°€ìƒ ì‚¬ìš©ì ìƒì„±ë¨');
                    } else {
                        log('ğŸ” ì‹¤ì œ Apple OAuth ì¸ì¦ ì™„ë£Œ');
                    }
                } else {
                    log('âš ï¸ ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                }
                
            } catch (error) {
                log(`âŒ Apple ë¡œê·¸ì¸ ì—ëŸ¬: ${error.message}`);
                console.error('Apple ë¡œê·¸ì¸ ì—ëŸ¬:', error);
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œì‹œ ì´ˆê¸°í™”
        window.addEventListener('load', function() {
            log('ğŸ“„ Apple Login ë””ë²„ê·¸ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œë¨');
            
            // URL íŒŒë¼ë¯¸í„°ë¡œ ëª¨ë“œ ì„¤ì • í™•ì¸
            const urlParams = new URLSearchParams(window.location.search);
            const modeParam = urlParams.get('mode');
            if (modeParam === 'production') {
                currentMode = 'production';
                const widget = document.getElementById('kommentio-widget');
                widget.setAttribute('data-supabase-url', 'https://nwjbtsjeikrwyqltkpqv.supabase.co');
                widget.setAttribute('data-supabase-key', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im53amJ0c2plaWtyd3lxbHRrcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk1NDA0MDUsImV4cCI6MjA2NTExNjQwNX0.UXNFgCrKfBHrcbenw94v9rD-sbGEE6ENDaF7h01EFPQ');
            }
            
            updateModeDisplay();
            
            setTimeout(() => {
                if (typeof kommentio !== 'undefined') {
                    log('âœ… Kommentio ìœ„ì ¯ ë¡œë“œ ì™„ë£Œ');
                    checkCurrentMode();
                } else {
                    log('âŒ Kommentio ìœ„ì ¯ ë¡œë“œ ì‹¤íŒ¨');
                }
            }, 1500);
        });
    </script>
</body>
</html>