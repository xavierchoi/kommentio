!function(){"use strict";class n{constructor(n={}){this.version="0.2.0",this.options={siteId:null,theme:"light",language:"ko",maxDepth:3,allowAnonymous:!0,supabaseUrl:null,supabaseKey:null,claudeApiKey:null,socialProviders:{google:{enabled:!0,label:"Google",color:"#ffffff",borderColor:"#dadce0",iconColor:"#4285f4",textColor:"#3c4043",hoverColor:"#f8f9fa"},apple:{enabled:!0,label:"Apple",color:"#000000",borderColor:"#000000",iconColor:"#ffffff",textColor:"#ffffff",hoverColor:"#333333"},github:{enabled:!0,label:"GitHub",color:"#24292f",borderColor:"#24292f",iconColor:"#ffffff",textColor:"#ffffff",hoverColor:"#32383f"},twitter:{enabled:!0,label:"X.com",color:"#000000",borderColor:"#000000",iconColor:"#ffffff",textColor:"#ffffff",hoverColor:"#272c30"},facebook:{enabled:!0,label:"Facebook",color:"#1877f2",borderColor:"#1877f2",iconColor:"#ffffff",textColor:"#ffffff",hoverColor:"#166fe5"},linkedin:{enabled:!0,label:"LinkedIn",color:"#0a66c2",borderColor:"#0a66c2",iconColor:"#ffffff",textColor:"#ffffff",hoverColor:"#004182"},kakao:{enabled:!0,label:"Kakao",color:"#fee500",borderColor:"#fee500",iconColor:"#000000",textColor:"#000000",hoverColor:"#fdd800"}},...n},this.container=null,this.comments=[],this.currentUser=null,this.supabase=null,this.init()}async init(){try{this.cleanupUrlFragment(),await this.loadSupabase(),this.createContainer(),this.attachStyles(),this.render(),this.attachEventListeners(),await this.handleOAuthCallback()}catch(n){}}cleanupUrlFragment(){const n=window.location.href;if(n.includes("##")){const e=n.replace("##","#");window.history.replaceState(null,"",e)}window.location.hash.includes("access_token=")&&setTimeout((()=>{const n=window.location.href.split("#")[0];window.history.replaceState(null,"",n)}),5e3)}async handleOAuthCallback(){var n,e,t;if(window.location.hash.includes("access_token=")||window.location.hash.includes("error=")){await new Promise((n=>setTimeout(n,1e3)));try{const{data:{session:o},error:i}=await this.supabase.auth.getSession();if(i)return void this.showNotification("로그인 처리 중 오류가 발생했습니다. 다시 시도해주세요. ⚠️");if(null==o?void 0:o.user){this.currentUser=o.user,this.render();const i=(null==(n=o.user.app_metadata)?void 0:n.provider)||"소셜",a=(null==(e=o.user.user_metadata)?void 0:e.name)||(null==(t=o.user.user_metadata)?void 0:t.full_name)||o.user.email;this.showNotification(`🎉 ${i} 로그인 완료! ${a}님 환영합니다!`),await this.loadComments()}else{const n=new URLSearchParams(window.location.hash.substring(1)),e=n.get("error"),t=n.get("error_description");e?this.showNotification(`로그인 실패: ${t||e} ❌`):this.showNotification("로그인을 완료하지 못했습니다. 다시 시도해주세요. ⚠️")}}catch(o){this.showNotification("로그인 처리 중 문제가 발생했습니다. 페이지를 새로고침해주세요. 🔄")}}}getSocialProviderIcon(n,e=20){return{google:`<svg width="${e}" height="${e}" viewBox="0 0 24 24" fill="none"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>`,apple:'<svg width="100%" height="100%" viewBox="0 0 56 56" fill="none" style="border-radius: 50%; overflow: hidden;">\n        <defs>\n          <style>\n            .apple-bg-light { fill: #ffffff; }\n            .apple-logo-light { fill: #000000; }\n            .apple-bg-dark { fill: #000000; }\n            .apple-logo-dark { fill: #ffffff; }\n            \n            /* 라이트 모드 기본 - 검은 배경에 흰 로고 표시 (바뀜) */\n            .apple-bg-light { display: none; }\n            .apple-logo-light { display: none; }\n            .apple-bg-dark { display: block; }\n            .apple-logo-dark { display: block; }\n            \n            /* 다크 모드 시 - 흰 배경에 검은 로고 표시 (바뀜) */\n            @media (prefers-color-scheme: dark) {\n              .apple-bg-light { display: block; }\n              .apple-logo-light { display: block; }\n              .apple-bg-dark { display: none; }\n              .apple-logo-dark { display: none; }\n            }\n            \n            /* Kommentio 위젯 다크테마 대응 (바뀜) */\n            .kommentio-widget[data-theme="dark"] .apple-bg-light { display: block; }\n            .kommentio-widget[data-theme="dark"] .apple-logo-light { display: block; }\n            .kommentio-widget[data-theme="dark"] .apple-bg-dark { display: none; }\n            .kommentio-widget[data-theme="dark"] .apple-logo-dark { display: none; }\n            \n            .kommentio-widget[data-theme="light"] .apple-bg-light { display: none; }\n            .kommentio-widget[data-theme="light"] .apple-logo-light { display: none; }\n            .kommentio-widget[data-theme="light"] .apple-bg-dark { display: block; }\n            .kommentio-widget[data-theme="light"] .apple-logo-dark { display: block; }\n          </style>\n          \x3c!-- 원형 마스크 정의 --\x3e\n          <mask id="apple-circle-mask">\n            <circle cx="28" cy="28" r="28" fill="white"/>\n          </mask>\n        </defs>\n        \x3c!-- 원형 마스크 적용된 그룹 --\x3e\n        <g mask="url(#apple-circle-mask)">\n          \x3c!-- 라이트 모드용 (흰 배경 + 검은 로고) --\x3e\n          <rect class="apple-bg-light" x="0" y="0" width="56" height="56"/>\n          <g class="apple-logo-light" transform="translate(28, 28) scale(1.2) translate(-28, -28)">\n            <path d="M28.2226562,20.3846154 C29.0546875,20.3846154 30.0976562,19.8048315 30.71875,19.0317864 C31.28125,18.3312142 31.6914062,17.352829 31.6914062,16.3744437 C31.6914062,16.2415766 31.6796875,16.1087095 31.65625,16 C30.7304687,16.0362365 29.6171875,16.640178 28.9492187,17.4494596 C28.421875,18.06548 27.9414062,19.0317864 27.9414062,20.0222505 C27.9414062,20.1671964 27.9648438,20.3121424 27.9765625,20.3604577 C28.0351562,20.3725366 28.1289062,20.3846154 28.2226562,20.3846154 Z M25.2929688,35 C26.4296875,35 26.9335938,34.214876 28.3515625,34.214876 C29.7929688,34.214876 30.109375,34.9758423 31.375,34.9758423 C32.6171875,34.9758423 33.4492188,33.792117 34.234375,32.6325493 C35.1132812,31.3038779 35.4765625,29.9993643 35.5,29.9389701 C35.4179688,29.9148125 33.0390625,28.9122695 33.0390625,26.0979021 C33.0390625,23.6579784 34.9140625,22.5588048 35.0195312,22.474253 C33.7773438,20.6382708 31.890625,20.5899555 31.375,20.5899555 C29.9804688,20.5899555 28.84375,21.4596313 28.1289062,21.4596313 C27.3554688,21.4596313 26.3359375,20.6382708 25.1289062,20.6382708 C22.8320312,20.6382708 20.5,22.5950413 20.5,26.2911634 C20.5,28.5861411 21.3671875,31.013986 22.4335938,32.5842339 C23.3476562,33.9129053 24.1445312,35 25.2929688,35 Z"/>\n          </g>\n          \x3c!-- 다크 모드용 (검은 배경 + 흰 로고) --\x3e\n          <rect class="apple-bg-dark" x="0" y="0" width="56" height="56"/>\n          <g class="apple-logo-dark" transform="translate(28, 28) scale(1.2) translate(-28, -28)">\n            <path d="M28.2226562,20.3846154 C29.0546875,20.3846154 30.0976562,19.8048315 30.71875,19.0317864 C31.28125,18.3312142 31.6914062,17.352829 31.6914062,16.3744437 C31.6914062,16.2415766 31.6796875,16.1087095 31.65625,16 C30.7304687,16.0362365 29.6171875,16.640178 28.9492187,17.4494596 C28.421875,18.06548 27.9414062,19.0317864 27.9414062,20.0222505 C27.9414062,20.1671964 27.9648438,20.3121424 27.9765625,20.3604577 C28.0351562,20.3725366 28.1289062,20.3846154 28.2226562,20.3846154 Z M25.2929688,35 C26.4296875,35 26.9335938,34.214876 28.3515625,34.214876 C29.7929688,34.214876 30.109375,34.9758423 31.375,34.9758423 C32.6171875,34.9758423 33.4492188,33.792117 34.234375,32.6325493 C35.1132812,31.3038779 35.4765625,29.9993643 35.5,29.9389701 C35.4179688,29.9148125 33.0390625,28.9122695 33.0390625,26.0979021 C33.0390625,23.6579784 34.9140625,22.5588048 35.0195312,22.474253 C33.7773438,20.6382708 31.890625,20.5899555 31.375,20.5899555 C29.9804688,20.5899555 28.84375,21.4596313 28.1289062,21.4596313 C27.3554688,21.4596313 26.3359375,20.6382708 25.1289062,20.6382708 C22.8320312,20.6382708 20.5,22.5950413 20.5,26.2911634 C20.5,28.5861411 21.3671875,31.013986 22.4335938,32.5842339 C23.3476562,33.9129053 24.1445312,35 25.2929688,35 Z"/>\n          </g>\n        </g>\n      </svg>',github:`<svg width="${e}" height="${e}" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0c4.42 0 8 3.58 8 8a8.1 8.1 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z"/></svg>`,twitter:`<svg width="${e}" height="${e}" viewBox="0 0 16 16" fill="currentColor"><path d="M12.6.75h2.454l-5.36 6.142L16 15.25h-4.937l-3.867-5.07-4.425 5.07H.316l5.733-6.57L0 .75h5.063l3.495 4.633L12.601.75Zm-.86 13.028h1.36L4.323 2.145H2.865l8.875 11.633Z"/></svg>`,facebook:`<svg width="${e}" height="${e}" viewBox="0 0 16 16" fill="currentColor"><path d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951z"/></svg>`,linkedin:`<svg width="${e}" height="${e}" viewBox="0 0 16 16" fill="currentColor"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"/></svg>`,kakao:'<svg width="100%" height="100%" viewBox="0 0 56 56" fill="none">\n        <defs>\n          \x3c!-- 원형 마스크 정의 --\x3e\n          <mask id="kakao-circle-mask">\n            <circle cx="28" cy="28" r="28" fill="white"/>\n          </mask>\n        </defs>\n        \n        \x3c!-- 원형 마스크 적용된 그룹 --\x3e\n        <g mask="url(#kakao-circle-mask)">\n          \x3c!-- 카카오 브랜드 색상 배경 (커브가 들어간 사각형을 원형으로 마스킹) --\x3e\n          <path fill="#FFE812" d="M56 36c0 11.046-8.954 20-20 20H20c-11.046 0-20-8.954-20-20V20C0 8.954 8.954 0 20 0h16c11.046 0 20 8.954 20 20v16z"/>\n          \n          \x3c!-- 카카오톡 말풍선 로고 (텍스트 제거) --\x3e\n          <g transform="translate(28, 28) scale(1.3) translate(-16, -16)">\n            <path d="M16 6C9.562 6 4 10.713 4 16.5c0 3.779 2.466 7.247 6.248 9.477-0.193 0.549-1.237 3.534-1.081 3.769 0 0-0.027 0.176 0.134 0.243s0.348 0.015 0.348 0.015c0.327-0.046 4.294-2.781 4.994-3.404C15.295 26.685 15.632 26.8 16 26.8c6.438 0 12-4.712 12-10.3S22.438 6 16 6z" fill="#000"/>\n          </g>\n        </g>\n      </svg>'}[n]||""}async loadSupabase(){if(!this.options.supabaseUrl||!this.options.supabaseKey)return this.mockMode=!0,void this.initMockData();try{window.supabase||await this.loadScript("https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"),this.supabase=window.supabase.createClient(this.options.supabaseUrl,this.options.supabaseKey);const{data:{user:n},error:e}=await this.supabase.auth.getUser(),t=localStorage.getItem("kommentio_custom_user");n?this.currentUser=n:t&&(this.currentUser=JSON.parse(t)),this.supabase.auth.onAuthStateChange((async(n,e)=>{var t,o,i;if("SIGNED_IN"===n&&(null==e?void 0:e.user)){this.currentUser=e.user,this.render();const n=(null==(t=e.user.app_metadata)?void 0:t.provider)||"",a=(null==(o=e.user.user_metadata)?void 0:o.name)||(null==(i=e.user.user_metadata)?void 0:i.full_name)||e.user.email;this.showNotification(`🎉 ${n?n+" ":""}로그인 완료! ${a}님 환영합니다!`),await this.loadComments()}else"SIGNED_OUT"===n?(this.currentUser=null,this.render(),this.showNotification("로그아웃되었습니다. 👋")):"TOKEN_REFRESHED"===n&&(null==e?void 0:e.user)&&(this.currentUser=e.user)})),this.mockMode=!1}catch(n){this.mockMode=!0,this.initMockData()}}loadScript(n){return new Promise(((e,t)=>{const o=document.createElement("script");o.src=n,o.onload=e,o.onerror=t,document.head.appendChild(o)}))}createContainer(){const n=document.querySelector("[data-kommentio]")||document.getElementById("kommentio");if(!n)throw new Error("Kommentio container not found. Add <div data-kommentio></div> to your page.");this.options.siteId=n.dataset.siteId||n.dataset.kommentio||window.location.hostname,this.container=n,this.container.className="kommentio-widget",this.container.setAttribute("data-theme",this.options.theme)}attachStyles(){if(document.getElementById("kommentio-styles"))return;const n=document.createElement("style");n.id="kommentio-styles",n.textContent=this.getStyles(),document.head.appendChild(n)}getStyles(){return"\n      .kommentio-widget {\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        max-width: 100%;\n        margin: 0 auto;\n        --kommentio-bg: #ffffff;\n        --kommentio-text: #1f2937;\n        --kommentio-border: #e5e7eb;\n        --kommentio-primary: #3b82f6;\n        --kommentio-secondary: #6b7280;\n      }\n\n      .kommentio-widget[data-theme=\"dark\"] {\n        --kommentio-bg: #1f2937;\n        --kommentio-text: #f9fafb;\n        --kommentio-border: #374151;\n        --kommentio-primary: #60a5fa;\n        --kommentio-secondary: #9ca3af;\n      }\n\n      .kommentio-container {\n        background: var(--kommentio-bg);\n        color: var(--kommentio-text);\n        border: 1px solid var(--kommentio-border);\n        border-radius: 8px;\n        padding: 1.5rem;\n      }\n\n      .kommentio-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        margin-bottom: 1.5rem;\n        padding-bottom: 1rem;\n        border-bottom: 1px solid var(--kommentio-border);\n      }\n\n      .kommentio-title {\n        font-size: 1.25rem;\n        font-weight: 600;\n        margin: 0;\n      }\n\n      .kommentio-auth {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 0.5rem;\n        align-items: center;\n      }\n\n      /* 🎨 새로운 원형 소셜 로그인 시스템 */\n      .kommentio-social-login {\n        display: grid;\n        grid-template-columns: repeat(7, 1fr);\n        gap: 12px;\n        margin-bottom: 1rem;\n        max-width: 100%;\n        justify-content: center;\n      }\n\n      .kommentio-btn {\n        padding: 0.5rem 1rem;\n        border: 1px solid var(--kommentio-border);\n        border-radius: 6px;\n        background: var(--kommentio-bg);\n        color: var(--kommentio-text);\n        cursor: pointer;\n        font-size: 0.875rem;\n        transition: all 0.2s;\n        display: flex;\n        align-items: center;\n        gap: 0.5rem;\n        min-width: fit-content;\n      }\n\n      .kommentio-btn:hover {\n        background: var(--kommentio-border);\n        transform: translateY(-1px);\n        box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n      }\n\n      .kommentio-btn:focus {\n        outline: 2px solid var(--kommentio-primary);\n        outline-offset: 2px;\n      }\n\n      .kommentio-btn-primary {\n        background: var(--kommentio-primary);\n        color: white;\n        border-color: var(--kommentio-primary);\n      }\n\n      /* 🔥 프리미엄 원형 소셜 로그인 버튼 */\n      .kommentio-btn-social {\n        width: 48px;\n        height: 48px;\n        border-radius: 50%;\n        border: 1px solid;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        padding: 0;\n        position: relative;\n        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n        cursor: pointer;\n        min-width: 48px;\n        min-height: 48px;\n        overflow: hidden;\n      }\n\n      /* Apple 아이콘은 전체 크기 + 원형 마스크 (Apple 가이드라인 준수) */\n      .kommentio-btn-apple svg {\n        /* 스케일링 제거 - Apple 로고가 이제 100% 크기로 원형 마스크 적용됨 */\n      }\n\n      .kommentio-btn-social:hover {\n        transform: translateY(-2px) scale(1.05);\n        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);\n      }\n\n      .kommentio-btn-social:active {\n        transform: translateY(0) scale(0.98);\n        transition: transform 0.1s ease;\n      }\n\n      .kommentio-btn-social:focus {\n        outline: 3px solid var(--kommentio-primary);\n        outline-offset: 2px;\n      }\n\n      /* Google 브랜딩 가이드라인 준수 */\n      .kommentio-btn-google {\n        background: #ffffff;\n        border-color: #dadce0;\n        color: #3c4043;\n      }\n\n      .kommentio-btn-google:hover {\n        background: #f8f9fa;\n        border-color: #dadce0;\n        box-shadow: 0 8px 25px rgba(60, 64, 67, 0.15);\n      }\n\n      .kommentio-btn-github {\n        background: #24292f;\n        border-color: #24292f;\n        color: #ffffff;\n      }\n\n      .kommentio-btn-github:hover {\n        background: #32383f;\n        border-color: #32383f;\n      }\n\n      .kommentio-btn-facebook {\n        background: #1877f2;\n        border-color: #1877f2;\n        color: #ffffff;\n      }\n\n      .kommentio-btn-facebook:hover {\n        background: #166fe5;\n        border-color: #166fe5;\n      }\n\n      .kommentio-btn-twitter {\n        background: #000000;\n        border-color: #000000;\n        color: #ffffff;\n      }\n\n      .kommentio-btn-twitter:hover {\n        background: #272c30;\n        border-color: #272c30;\n      }\n\n      .kommentio-btn-apple {\n        background: #000000;\n        border: none;\n        color: #ffffff;\n      }\n\n      .kommentio-btn-apple:hover {\n        background: #1d1d1f;\n        border: none;\n      }\n\n      .kommentio-btn-linkedin {\n        background: #0a66c2;\n        border-color: #0a66c2;\n        color: #ffffff;\n      }\n\n      .kommentio-btn-linkedin:hover {\n        background: #004182;\n        border-color: #004182;\n      }\n\n      .kommentio-btn-kakao {\n        background: #fee500;\n        border: none;\n        color: #000000;\n      }\n\n      .kommentio-btn-kakao:hover {\n        background: #fdd835;\n        border: none;\n      }\n\n\n      .kommentio-user-info {\n        display: flex;\n        align-items: center;\n        gap: 0.5rem;\n        font-size: 0.875rem;\n        color: var(--kommentio-secondary);\n      }\n\n      .kommentio-logout-btn {\n        padding: 0.25rem 0.75rem;\n        font-size: 0.75rem;\n        background: transparent;\n        border: 1px solid var(--kommentio-border);\n        color: var(--kommentio-secondary);\n      }\n\n      .kommentio-form {\n        margin-bottom: 2rem;\n      }\n\n      .kommentio-textarea {\n        width: 100%;\n        min-height: 100px;\n        padding: 0.75rem;\n        border: 1px solid var(--kommentio-border);\n        border-radius: 6px;\n        background: var(--kommentio-bg);\n        color: var(--kommentio-text);\n        resize: vertical;\n        font-family: inherit;\n        box-sizing: border-box;\n      }\n\n      .kommentio-comments {\n        space-y: 1rem;\n      }\n\n      .kommentio-comment {\n        border: 1px solid var(--kommentio-border);\n        border-radius: 6px;\n        padding: 1rem;\n        margin-bottom: 1rem;\n      }\n\n      .kommentio-comment-nested {\n        margin-left: 2rem;\n        margin-top: 1rem;\n      }\n\n      .kommentio-comment-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        margin-bottom: 0.5rem;\n      }\n\n      .kommentio-author {\n        font-weight: 600;\n        color: var(--kommentio-primary);\n      }\n\n      .kommentio-timestamp {\n        color: var(--kommentio-secondary);\n        font-size: 0.875rem;\n      }\n\n      .kommentio-content {\n        line-height: 1.6;\n        margin-bottom: 0.75rem;\n      }\n\n      .kommentio-actions {\n        display: flex;\n        gap: 1rem;\n        font-size: 0.875rem;\n      }\n\n      .kommentio-action {\n        color: var(--kommentio-secondary);\n        cursor: pointer;\n        transition: color 0.2s;\n      }\n\n      .kommentio-action:hover {\n        color: var(--kommentio-primary);\n      }\n\n      .kommentio-loading {\n        text-align: center;\n        padding: 2rem;\n        color: var(--kommentio-secondary);\n      }\n\n      .kommentio-error {\n        background: #fef2f2;\n        color: #dc2626;\n        padding: 1rem;\n        border-radius: 6px;\n        margin-bottom: 1rem;\n      }\n\n      /* 반응형 디자인 - Desktop First 접근법 */\n      \n      /* 태블릿 최적화 (1024px 이하) */\n      @media (max-width: 1024px) {\n        .kommentio-header {\n          flex-direction: column;\n          gap: 1rem;\n          align-items: stretch;\n        }\n        \n        /* 태블릿에서 소셜 로그인 최적화 */\n        .kommentio-social-login {\n          grid-template-columns: repeat(7, 1fr);\n          gap: 16px;\n          justify-content: center;\n          max-width: 100%;\n        }\n        \n        .kommentio-btn-social {\n          width: 56px;\n          height: 56px;\n          min-width: 56px;\n          min-height: 56px;\n        }\n        \n        /* 태블릿에서 Apple 아이콘 (원형 마스크 적용으로 스케일링 불필요) */\n        .kommentio-btn-apple svg {\n          /* 스케일링 제거 - 100% 크기 + 원형 마스크로 처리 */\n        }\n        \n        .kommentio-textarea {\n          min-height: 100px;\n        }\n      }\n      \n      /* 모바일 최적화 (768px 이하) */\n      @media (max-width: 768px) {\n        .kommentio-container {\n          padding: 1rem;\n          border-radius: 8px;\n          margin: 0.5rem;\n        }\n        \n        .kommentio-title {\n          font-size: 1.125rem;\n          margin-bottom: 1rem;\n        }\n        \n        .kommentio-widget {\n          font-size: 16px; /* iOS 줌 방지 */\n        }\n        \n        .kommentio-textarea {\n          font-size: 16px; /* iOS 줌 방지 */\n          min-height: 120px;\n          padding: 12px;\n        }\n        \n        .kommentio-comment-nested {\n          margin-left: 1rem; /* 모바일에서 중첩 간격 줄임 */\n        }\n        \n        .kommentio-comment-nested .kommentio-comment-nested {\n          margin-left: 0.5rem; /* 3단계 중첩 더 줄임 */\n        }\n        \n        .kommentio-author {\n          font-size: 0.875rem;\n        }\n        \n        .kommentio-timestamp {\n          font-size: 0.75rem;\n        }\n        \n        .kommentio-actions {\n          flex-wrap: wrap;\n          gap: 0.5rem;\n        }\n        \n        .kommentio-btn-action {\n          min-height: 44px;\n          min-width: 44px;\n          padding: 8px 12px;\n          display: inline-flex;\n          align-items: center;\n          justify-content: center;\n        }\n        \n        .kommentio-notification {\n          left: 10px !important;\n          right: 10px !important;\n          top: 10px !important;\n          width: auto !important;\n          font-size: 0.875rem;\n        }\n      }\n      \n      /* 소형 모바일 (640px 이하) */\n      @media (max-width: 640px) {\n        .kommentio-container {\n          padding: 0.75rem;\n          margin: 0.25rem;\n        }\n        \n        /* 모바일에서 소셜 로그인 4열 그리드 */\n        .kommentio-social-login {\n          grid-template-columns: repeat(4, 1fr);\n          gap: 12px;\n          justify-content: center;\n          max-width: 100%;\n          margin: 0 auto 1rem auto;\n        }\n        \n        .kommentio-btn-social {\n          width: 48px;\n          height: 48px;\n          min-width: 48px;\n          min-height: 48px;\n          justify-self: center;\n        }\n        \n        /* 모바일에서 Apple 아이콘 (원형 마스크 적용으로 스케일링 불필요) */\n        .kommentio-btn-apple svg {\n          /* 스케일링 제거 - 100% 크기 + 원형 마스크로 처리 */\n        }\n        \n        .kommentio-comment {\n          border-left: none;\n          border-right: none;\n          border-radius: 0;\n          margin-left: -0.75rem;\n          margin-right: -0.75rem;\n          padding-left: 0.75rem;\n          padding-right: 0.75rem;\n        }\n        \n        .kommentio-comment-header {\n          flex-direction: column;\n          align-items: flex-start;\n          gap: 0.25rem;\n        }\n        \n        .kommentio-form {\n          padding: 0.75rem;\n        }\n        \n        .kommentio-form-actions {\n          flex-direction: column;\n          gap: 0.5rem;\n        }\n        \n        .kommentio-btn {\n          width: 100%;\n          min-height: 44px;\n          justify-content: center;\n        }\n      }\n      \n      /* 초소형 모바일 (480px 이하) */\n      @media (max-width: 480px) {\n        .kommentio-title {\n          font-size: 1rem;\n        }\n        \n        .kommentio-comment-nested {\n          margin-left: 0.5rem;\n        }\n        \n        .kommentio-comment-nested .kommentio-comment-nested {\n          margin-left: 0.25rem;\n        }\n        \n        .kommentio-author {\n          font-size: 0.8125rem;\n        }\n        \n        .kommentio-timestamp {\n          font-size: 0.6875rem;\n        }\n        \n        .kommentio-textarea {\n          min-height: 100px;\n          padding: 10px;\n        }\n      }\n      \n      /* 터치 친화적 인터페이스 */\n      @media (hover: none) and (pointer: coarse) {\n        .kommentio-btn:hover {\n          transform: none; /* 터치 디바이스에서 호버 효과 제거 */\n        }\n        \n        .kommentio-btn:active {\n          transform: scale(0.98);\n          transition: transform 0.1s ease;\n        }\n        \n        /* 소셜 버튼 터치 최적화 */\n        .kommentio-btn-social:hover {\n          transform: none;\n          box-shadow: none;\n        }\n        \n        .kommentio-btn-social:active {\n          transform: scale(0.95);\n          transition: transform 0.1s ease;\n        }\n        \n        .kommentio-comment-actions button:hover {\n          background: transparent;\n        }\n        \n        .kommentio-comment-actions button:active {\n          background: var(--kommentio-bg-secondary);\n          border-radius: 4px;\n        }\n      }\n      \n      /* 가로 모드 최적화 */\n      @media (max-height: 500px) and (orientation: landscape) {\n        .kommentio-container {\n          padding: 0.5rem;\n        }\n        \n        .kommentio-textarea {\n          min-height: 80px;\n        }\n        \n        .kommentio-title {\n          font-size: 1rem;\n          margin-bottom: 0.5rem;\n        }\n      }\n    "}render(){this.container&&(this.container.innerHTML=`\n      <div class="kommentio-container">\n        <header class="kommentio-header">\n          <h3 class="kommentio-title">댓글</h3>\n          <div class="kommentio-auth">\n            ${this.renderAuthButtons()}\n          </div>\n        </header>\n        \n        ${this.renderCommentForm()}\n        \n        <div class="kommentio-comments" id="kommentio-comments">\n          <div class="kommentio-loading">댓글을 불러오는 중...</div>\n        </div>\n      </div>\n    `,this.loadComments())}renderAuthButtons(){var n;if(this.currentUser)return`\n        <div class="kommentio-user-info">\n          <span>안녕하세요, ${(null==(n=this.currentUser.user_metadata)?void 0:n.name)||this.currentUser.email}</span>\n          <button class="kommentio-btn kommentio-logout-btn" onclick="kommentio.logout()">로그아웃</button>\n        </div>\n      `;const e=Object.entries(this.options.socialProviders).filter((([,n])=>n.enabled));if(0===e.length)return'<p class="kommentio-text-secondary">로그인 옵션이 설정되지 않았습니다.</p>';return`\n      <div class="kommentio-social-login">\n        ${e.map((([n,e],t)=>`\n        <button \n          class="kommentio-btn kommentio-btn-social kommentio-btn-${n}" \n          onclick="kommentio.login('${n}')"\n          title="${e.label}로 로그인"\n          aria-label="${e.label}로 로그인"\n          tabindex="${0===t?"0":"-1"}"\n          role="button"\n        >\n          ${this.getSocialProviderIcon(n,24)}\n        </button>\n      `)).join("")}\n      </div>\n    `}updateSocialProviders(n){Object.assign(this.options.socialProviders,n),this.render()}toggleSocialProvider(n,e){this.options.socialProviders[n]&&(this.options.socialProviders[n].enabled=e,this.render())}renderCommentForm(){return this.currentUser||this.options.allowAnonymous?'\n      <form class="kommentio-form" onsubmit="kommentio.handleSubmit(event)">\n        <textarea \n          class="kommentio-textarea" \n          placeholder="댓글을 입력하세요..."\n          required\n        ></textarea>\n        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 0.75rem;">\n          <small class="kommentio-text-secondary">Markdown 문법을 지원합니다. • Ctrl+Enter로 빠른 등록</small>\n          <button type="submit" class="kommentio-btn kommentio-btn-primary">댓글 작성</button>\n        </div>\n      </form>\n    ':'<p class="kommentio-text-secondary">댓글을 작성하려면 로그인해주세요.</p>'}initMockData(){this.mockComments=[{id:"mock-1",site_id:this.options.siteId,page_url:window.location.pathname,content:"Kommentio 정말 좋네요! Disqus보다 훨씬 빠르고 깔끔한 것 같아요. 👍",parent_id:null,depth:0,author_name:"김개발",author_email:"dev@example.com",likes_count:5,created_at:new Date(Date.now()-72e5).toISOString(),children:[]},{id:"mock-2",site_id:this.options.siteId,page_url:window.location.pathname,content:"오픈소스라서 더욱 신뢰가 갑니다. 광고도 없고 완전 무료라니 최고예요!",parent_id:null,depth:0,author_name:"박코더",author_email:"coder@example.com",likes_count:3,created_at:new Date(Date.now()-36e5).toISOString(),children:[]},{id:"mock-3",site_id:this.options.siteId,page_url:window.location.pathname,content:"맞아요! 로딩 속도가 정말 빨라요. React 없이 Vanilla JS로 만든 덕분인 것 같아요.",parent_id:"mock-1",depth:1,author_name:"최성능",author_email:"performance@example.com",likes_count:2,created_at:new Date(Date.now()-54e5).toISOString(),children:[]},{id:"mock-4",site_id:this.options.siteId,page_url:window.location.pathname,content:"정말 인상적인 프로젝트네요! PRD 명세대로 잘 구현되고 있는 것 같아요. 🚀",parent_id:null,depth:0,author_name:"프로젝트매니저",author_email:"pm@example.com",likes_count:4,created_at:new Date(Date.now()-6e5).toISOString(),children:[]}]}async loadComments(){if(this.mockMode)return this.comments=this.buildCommentTree(this.mockComments),void this.renderComments();try{const{data:n,error:e}=await this.supabase.from("comments").select("*").eq("site_id",this.options.siteId).eq("page_url",window.location.pathname).eq("is_deleted",!1).order("created_at",{ascending:!0});if(e)throw e;this.comments=this.buildCommentTree(n||[]),this.renderComments()}catch(n){this.renderError("댓글을 불러오는데 실패했습니다.")}}buildCommentTree(n){const e={},t=[];return n.forEach((n=>{n.children=[],e[n.id]=n})),n.forEach((n=>{n.parent_id&&e[n.parent_id]?e[n.parent_id].children.push(n):t.push(n)})),t}renderComments(){const n=document.getElementById("kommentio-comments");n&&(0!==this.comments.length?n.innerHTML=this.comments.map((n=>this.renderComment(n))).join(""):n.innerHTML='<p class="kommentio-text-secondary">첫 번째 댓글을 작성해보세요!</p>')}renderComment(n,e=0){const t=e>0,o=e<this.options.maxDepth;return`\n      <div class="kommentio-comment ${t?"kommentio-comment-nested":""}" data-comment-id="${n.id}">\n        <div class="kommentio-comment-header">\n          <span class="kommentio-author">${n.author_name||"익명"}</span>\n          <span class="kommentio-timestamp">${this.formatDate(n.created_at)}</span>\n        </div>\n        \n        <div class="kommentio-content">${this.sanitizeContent(n.content)}</div>\n        \n        <div class="kommentio-actions">\n          <span class="kommentio-action" onclick="kommentio.likeComment('${n.id}')">\n            👍 ${n.likes||0}\n          </span>\n          ${o?`<span class="kommentio-action" onclick="kommentio.replyTo('${n.id}')">답글</span>`:""}\n        </div>\n        \n        ${n.children.map((n=>this.renderComment(n,e+1))).join("")}\n      </div>\n    `}formatDate(n){const e=new Date(n),t=new Date-e;return t<6e4?"방금 전":t<36e5?`${Math.floor(t/6e4)}분 전`:t<864e5?`${Math.floor(t/36e5)}시간 전`:e.toLocaleDateString("ko-KR")}sanitizeContent(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/\n/g,"<br>")}renderError(n){const e=document.getElementById("kommentio-comments");e&&(e.innerHTML=`<div class="kommentio-error">${n}</div>`)}attachEventListeners(){this.container.addEventListener("keydown",(n=>{if("Tab"===n.key&&this.handleTabNavigation(n),"Enter"!==n.key&&" "!==n.key||!n.target.classList.contains("kommentio-btn-social")||(n.preventDefault(),n.target.click()),(n.ctrlKey||n.metaKey)&&"Enter"===n.key&&n.target.classList.contains("kommentio-textarea")){n.preventDefault();const e=n.target.closest("form");e&&e.dispatchEvent(new Event("submit",{bubbles:!0}))}"Escape"===n.key&&n.target.blur()})),this.mockMode?this.simulateRealtimeUpdates():this.supabase&&this.setupRealtimeSubscription()}handleTabNavigation(n){const e=this.container.querySelectorAll(".kommentio-btn-social"),t=Array.from(e).indexOf(n.target);0!==e.length&&(n.shiftKey?0===t&&(n.preventDefault(),e[e.length-1].focus()):t===e.length-1&&(n.preventDefault(),e[0].focus()))}simulateRealtimeUpdates(){setInterval((()=>{if(Math.random()>.7){const n=["실시간 업데이트 테스트입니다! 👋","Mock 모드에서도 실시간 기능이 잘 동작하네요!","새로운 댓글이 자동으로 추가되었습니다.","Kommentio 실시간 업데이트 데모 중...","이 댓글은 30초마다 자동으로 생성됩니다."],e=["실시간테스터","자동댓글봇","Mock사용자","데모계정"],t={id:"mock-realtime-"+Date.now(),site_id:this.options.siteId,page_url:window.location.pathname,content:n[Math.floor(Math.random()*n.length)],parent_id:null,depth:0,author_name:e[Math.floor(Math.random()*e.length)],author_email:"realtime@example.com",likes_count:Math.floor(5*Math.random()),created_at:(new Date).toISOString(),children:[]};this.mockComments.push(t),this.comments=this.buildCommentTree(this.mockComments),this.renderComments(),this.showNotification("새 댓글이 추가되었습니다! 🔄")}}),3e4)}showNotification(n){const e=document.createElement("div");if(e.style.cssText="\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      background: #3b82f6;\n      color: white;\n      padding: 12px 16px;\n      border-radius: 6px;\n      font-size: 14px;\n      z-index: 1000;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n      animation: slideIn 0.3s ease-out;\n    ",e.textContent=n,document.body.appendChild(e),!document.getElementById("kommentio-notification-styles")){const n=document.createElement("style");n.id="kommentio-notification-styles",n.textContent="\n        @keyframes slideIn {\n          from {\n            transform: translateX(100%);\n            opacity: 0;\n          }\n          to {\n            transform: translateX(0);\n            opacity: 1;\n          }\n        }\n      ",document.head.appendChild(n)}setTimeout((()=>{e.style.opacity="0",e.style.transform="translateX(100%)",setTimeout((()=>{e.parentNode&&e.parentNode.removeChild(e)}),300)}),3e3)}setupRealtimeSubscription(){try{const n=`comments-${this.options.siteId}`;this.realtimeChannel=this.supabase.channel(n).on("postgres_changes",{event:"*",schema:"public",table:"comments",filter:`site_id=eq.${this.options.siteId}`},(n=>{this.handleRealtimeCommentEvent(n)})).on("postgres_changes",{event:"*",schema:"public",table:"comment_likes",filter:`comment_id=in.(${this.getAllCommentIds().join(",")})`},(n=>{this.handleRealtimeLikeEvent(n)})).subscribe((n=>{"SUBSCRIBED"===n?this.showNotification("🔄 실시간 업데이트가 활성화되었습니다!"):"CHANNEL_ERROR"===n&&this.showNotification("⚠️ 실시간 업데이트 연결에 문제가 있습니다.")}))}catch(n){}}handleRealtimeCommentEvent(n){const{eventType:e,new:t,old:o}=n;switch(e){case"INSERT":t&&t.site_id===this.options.siteId&&(this.showNotification(`💬 새 댓글: ${t.author_name}`),this.loadComments());break;case"UPDATE":t&&t.site_id===this.options.siteId&&(!1===o.is_deleted&&!0===t.is_deleted?this.showNotification("🗑️ 댓글이 삭제되었습니다."):this.showNotification("✏️ 댓글이 수정되었습니다."),this.loadComments());break;case"DELETE":this.showNotification("🗑️ 댓글이 삭제되었습니다."),this.loadComments()}}handleRealtimeLikeEvent(n){const{eventType:e,new:t}=n;"INSERT"===e&&t?(this.showNotification("❤️ 새로운 좋아요!"),this.updateCommentLikeCount(t.comment_id)):"DELETE"===e&&this.updateCommentLikeCount(n.old.comment_id)}getAllCommentIds(){const n=e=>{let t=[];for(const o of e)t.push(o.id),o.children&&o.children.length>0&&(t=t.concat(n(o.children)));return t};return this.comments?n(this.comments):[]}async updateCommentLikeCount(n){try{const{data:e,error:t}=await this.supabase.from("comments").select("likes_count").eq("id",n).single();if(t)throw t;const o=this.container.querySelector(`[data-comment-id="${n}"] .kommentio-btn-like`);o&&(o.textContent=`👍 ${e.likes_count||0}`)}catch(e){}}unsubscribeRealtime(){this.realtimeChannel&&(this.supabase.removeChannel(this.realtimeChannel),this.realtimeChannel=null)}async handleSubmit(n){n.preventDefault();const e=n.target.querySelector("textarea"),t=e.value.trim();if(!t)return;const o=n.target.querySelector('button[type="submit"]'),i=o.textContent;o.disabled=!0,o.textContent="작성 중...";try{const n=await this.createComment(t);e.value="",await this.loadComments(),n&&n.isSpam?this.showNotification("스팸으로 감지된 댓글입니다. 관리자 승인 후 게시됩니다. ⚠️"):this.showNotification("댓글이 성공적으로 작성되었습니다! ✅")}catch(a){this.showNotification("댓글 작성에 실패했습니다. 다시 시도해주세요. ❌")}finally{o.disabled=!1,o.textContent=i,e.focus()}}async checkSpamWithClaude(n){if(!this.options.claudeApiKey)return{spam_score:0,reason:"Claude API key not provided",is_spam:!1};try{const e=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.options.claudeApiKey,"anthropic-version":"2023-06-01"},body:JSON.stringify({model:"claude-3-haiku-20240307",max_tokens:100,messages:[{role:"user",content:`다음 댓글이 스팸인지 분석해주세요. 0.0(정상)에서 1.0(스팸) 사이의 점수와 간단한 이유를 JSON 형태로 응답해주세요:\n\n댓글: "${n}"\n\n응답 형식:\n{\n  "spam_score": 0.8,\n  "reason": "상업적 링크 포함"\n}`}]})});if(!e.ok)throw new Error(`Claude API 호출 실패: ${e.status}`);const t=await e.json(),o=JSON.parse(t.content[0].text);return{spam_score:o.spam_score,reason:o.reason,is_spam:o.spam_score>.7}}catch(e){return{spam_score:0,reason:"API 호출 실패",is_spam:!1}}}async createComment(n,e=null){var t,o,i,a,r,s,m,l,c;if(this.mockMode){const r=Math.random()>.9,s={id:"mock-"+Date.now(),site_id:this.options.siteId,page_url:window.location.pathname,content:n,parent_id:e,depth:e?1:0,author_name:(null==(o=null==(t=this.currentUser)?void 0:t.user_metadata)?void 0:o.name)||(null==(i=this.currentUser)?void 0:i.email)||"익명",author_email:(null==(a=this.currentUser)?void 0:a.email)||null,likes_count:0,spam_score:r?.8:.1,spam_reason:r?"Mock 스팸 감지":null,is_spam:r,created_at:(new Date).toISOString(),children:[]};return this.mockComments.push(s),this.comments=this.buildCommentTree(this.mockComments),this.renderComments(),{isSpam:r}}let d={spam_score:0,reason:null,is_spam:!1};if(this.options.claudeApiKey)try{d=await this.checkSpamWithClaude(n)}catch(p){}const{error:h}=await this.supabase.from("comments").insert({site_id:this.options.siteId,page_url:window.location.pathname,content:n,parent_id:e,author_id:null==(r=this.currentUser)?void 0:r.id,author_name:(null==(m=null==(s=this.currentUser)?void 0:s.user_metadata)?void 0:m.name)||(null==(l=this.currentUser)?void 0:l.email)||"익명",author_email:null==(c=this.currentUser)?void 0:c.email,spam_score:d.spam_score,spam_reason:d.reason,is_spam:d.is_spam,is_approved:!d.is_spam});if(h)throw h;return{isSpam:d.is_spam}}getSupabaseProvider(n){return{google:"google",github:"github",facebook:"facebook",twitter:"twitter",apple:"apple",linkedin:"linkedin",kakao:"kakao"}[n]||n}getProviderOptions(n){const e={redirectTo:window.location.href.split("#")[0]};switch(n){case"apple":return{...e,scopes:"name email"};case"linkedin":return{...e,scopes:"openid profile email"};case"kakao":return{...e,scopes:"profile_nickname profile_image account_email"};default:return e}}async login(n){var e,t;const o=this.options.socialProviders[n];if(o&&o.enabled){if(this.mockMode)return this.currentUser={id:"mock-user-"+Date.now(),email:`${n}user@example.com`,user_metadata:{name:`${o.label} 사용자`,avatar_url:`https://ui-avatars.com/api/?name=${o.icon}&background=3b82f6&color=fff`,provider:n}},this.showNotification(`${o.label} 로그인 완료! (Mock 모드) 🎉`),void this.render();try{if([].includes(n))return this.currentUser={id:`mock-${n}-user-`+Date.now(),email:`${n}user@example.com`,user_metadata:{name:`${o.label} 사용자 (Mock)`,avatar_url:`https://ui-avatars.com/api/?name=${o.label}&background=3b82f6&color=fff`,provider:n}},this.showNotification(`${o.label} 로그인 완료! (설정 미완료로 Mock 모드) 🎉`),void this.render();if([].includes(n))return this.currentUser={id:"mock-user-"+Date.now(),email:`${n}user@example.com`,user_metadata:{name:`${o.label} 사용자`,avatar_url:`https://ui-avatars.com/api/?name=${o.icon}&background=3b82f6&color=fff`,provider:n}},this.showNotification(`${o.label} 로그인 완료! (설정 미완료로 Mock 모드) 🎉`),void this.render();const e=this.getSupabaseProvider(n),t=this.getProviderOptions(n),{error:i}=await this.supabase.auth.signInWithOAuth({provider:e,options:t});if(i)throw i;this.showNotification(`${o.label} 로그인 중... 🔄`)}catch(i){if("kakao"===n)return void this.showNotification("카카오 로그인에 실패했습니다. 콘솔에서 디버깅 정보를 확인해주세요. 🥕");let a="로그인에 실패했습니다.";if((null==(e=i.message)?void 0:e.includes("not supported"))||(null==(t=i.message)?void 0:t.includes("not enabled")))return this.currentUser={id:"mock-user-"+Date.now(),email:`${n}user@example.com`,user_metadata:{name:`${o.label} 사용자`,avatar_url:`https://ui-avatars.com/api/?name=${o.icon}&background=3b82f6&color=fff`,provider:n}},this.showNotification(`${o.label} 로그인 완료! (설정 미완료로 Mock 모드) ⚠️`),void this.render();alert(a)}}else alert("지원하지 않는 로그인 방식입니다.")}async logout(){if(this.mockMode)return this.currentUser=null,void this.render();try{await this.supabase.auth.signOut(),localStorage.removeItem("kommentio_custom_user"),localStorage.removeItem("kommentio_custom_token");const n=window.location.href.split("#")[0];window.history.replaceState(null,"",n),this.currentUser=null,this.render(),this.showNotification("로그아웃되었습니다. 👋")}catch(n){}}async handleKoreanSocialLogin(n){}async handleKakaoLogin(){if(!this.getKakaoConfig().apiKey)return this.currentUser={id:"mock-kakao-user-"+Date.now(),email:"kakaouser@example.com",user_metadata:{name:"Kakao 사용자",avatar_url:"https://ui-avatars.com/api/?name=Kakao&background=fee500&color=000",provider:"kakao"}},this.showNotification("Kakao 로그인 완료! (설정 미완료로 Mock 모드) 🎉"),void this.render();try{return await this.loadKakaoSDK(),new Promise(((n,e)=>{window.Kakao.Auth.login({success:async t=>{try{window.Kakao.API.request({url:"/v2/user/me",success:async e=>{await this.loginWithKakaoUser(e,t.access_token),n()},fail:e})}catch(o){e(o)}},fail:e})}))}catch(n){this.currentUser={id:"mock-kakao-user-"+Date.now(),email:"kakaouser@example.com",user_metadata:{name:"Kakao 사용자",avatar_url:"https://ui-avatars.com/api/?name=Kakao&background=fee500&color=000",provider:"kakao"}},this.showNotification("Kakao 로그인 완료! (SDK 로드 실패로 Mock 모드) 🎉"),this.render()}}async loadKakaoSDK(){if(window.Kakao)return;await this.loadScript("https://developers.kakao.com/sdk/js/kakao.js");const n=this.getKakaoConfig();window.Kakao.init(n.apiKey)}getKakaoConfig(){return{apiKey:this.options.kakaoApiKey||process.env.VITE_KAKAO_API_KEY,redirectUri:`${window.location.origin}/auth/kakao/callback`}}async loginWithKakaoUser(n,e){var t,o,i,a,r,s,m;const l={id:`kakao_${n.id}`,email:(null==(t=n.kakao_account)?void 0:t.email)||`kakao_${n.id}@kakao.local`,user_metadata:{name:(null==(i=null==(o=n.kakao_account)?void 0:o.profile)?void 0:i.nickname)||"카카오 사용자",avatar_url:null==(r=null==(a=n.kakao_account)?void 0:a.profile)?void 0:r.profile_image_url,provider:"kakao",provider_id:n.id.toString(),full_name:null==(m=null==(s=n.kakao_account)?void 0:s.profile)?void 0:m.nickname}};await this.loginWithCustomUser(l,e),this.showNotification("카카오 로그인 완료! 🎉")}async loginWithCustomUser(n,e){try{this.currentUser={id:n.id,email:n.email,user_metadata:n.user_metadata},localStorage.setItem("kommentio_custom_user",JSON.stringify(this.currentUser)),localStorage.setItem("kommentio_custom_token",e),this.render()}catch(t){throw t}}async likeComment(n){try{const{error:e}=await this.supabase.rpc("increment_likes",{comment_id:n});if(e)throw e}catch(e){}}replyTo(n){if(!this.currentUser&&!this.options.allowAnonymous)return void alert("답글을 작성하려면 로그인해주세요.");const e=document.querySelector(".kommentio-reply-form");e&&e.remove();const t=document.querySelector(`[data-comment-id="${n}"]`);if(!t)return;const o=document.createElement("div");o.className="kommentio-reply-form",o.style.cssText="\n      margin-top: 1rem;\n      padding: 1rem;\n      background: var(--kommentio-bg);\n      border: 1px solid var(--kommentio-border);\n      border-radius: 6px;\n      border-left: 3px solid var(--kommentio-primary);\n    ",o.innerHTML=`\n      <div style="margin-bottom: 0.75rem;">\n        <strong style="color: var(--kommentio-primary);">답글 작성</strong>\n        <button \n          onclick="this.closest('.kommentio-reply-form').remove()" \n          style="float: right; background: none; border: none; color: var(--kommentio-secondary); cursor: pointer; font-size: 1.2rem;"\n          title="닫기"\n        >×</button>\n      </div>\n      <form onsubmit="kommentio.handleReplySubmit(event, '${n}')">\n        <textarea \n          class="kommentio-textarea" \n          placeholder="답글을 입력하세요..."\n          style="min-height: 80px; margin-bottom: 0.75rem;"\n          required\n        ></textarea>\n        <div style="display: flex; justify-content: space-between; align-items: center;">\n          <small style="color: var(--kommentio-secondary);">Markdown 문법을 지원합니다. • Ctrl+Enter로 빠른 등록</small>\n          <div style="display: flex; gap: 0.5rem;">\n            <button \n              type="button" \n              onclick="this.closest('.kommentio-reply-form').remove()"\n              style="padding: 0.5rem 1rem; border: 1px solid var(--kommentio-border); background: var(--kommentio-bg); color: var(--kommentio-text); border-radius: 4px; cursor: pointer;"\n            >취소</button>\n            <button \n              type="submit" \n              style="padding: 0.5rem 1rem; background: var(--kommentio-primary); color: white; border: none; border-radius: 4px; cursor: pointer;"\n            >답글 작성</button>\n          </div>\n        </div>\n      </form>\n    `,t.appendChild(o);o.querySelector("textarea").focus(),o.scrollIntoView({behavior:"smooth",block:"nearest"})}async handleReplySubmit(n,e){n.preventDefault();const t=n.target.querySelector("textarea").value.trim();if(!t)return;const o=n.target.querySelector('button[type="submit"]'),i=o.textContent;o.disabled=!0,o.textContent="작성 중...";try{const o=await this.createComment(t,e),i=n.target.closest(".kommentio-reply-form");i&&i.remove(),await this.loadComments(),o&&o.isSpam?this.showNotification("스팸으로 감지된 답글입니다. 관리자 승인 후 게시됩니다. ⚠️"):this.showNotification("답글이 성공적으로 작성되었습니다! ✅")}catch(a){this.showNotification("답글 작성에 실패했습니다. 다시 시도해주세요. ❌")}finally{o&&(o.disabled=!1,o.textContent=i)}}}let e;function t(){const t=document.querySelector("[data-kommentio]");if(t){const o={siteId:t.dataset.siteId,theme:t.dataset.theme||"light",language:t.dataset.language||"ko",supabaseUrl:t.dataset.supabaseUrl||null,supabaseKey:t.dataset.supabaseKey||null,claudeApiKey:t.dataset.claudeApiKey};e=new n(o),window.kommentio=e}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t(),window.Kommentio=n,window.kommentio=null,window.waitForKommentio=function(n,e=5e3){const t=Date.now();!function o(){window.kommentio&&window.kommentio.updateSocialProviders?n(window.kommentio):Date.now()-t>e?alert("위젯 로딩이 너무 오래 걸립니다. 페이지를 새로고침해주세요."):setTimeout(o,50)}()}}();
