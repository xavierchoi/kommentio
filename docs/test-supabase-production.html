<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase Production í†µí•© í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 2rem;
            background: #f9fafb;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .status {
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
        }
        .success { background: #10b981; color: white; }
        .warning { background: #f59e0b; color: white; }
        .error { background: #ef4444; color: white; }
        .info { background: #3b82f6; color: white; }
        .test-section {
            margin-top: 2rem;
            padding: 1rem;
            background: #f3f4f6;
            border-radius: 8px;
        }
        .test-output {
            background: #1f2937;
            color: #f3f4f6;
            padding: 1rem;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 1rem;
        }
        button {
            padding: 0.75rem 1.5rem;
            margin: 0.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
        }
        .btn-primary { background: #3b82f6; color: white; }
        .btn-success { background: #10b981; color: white; }
        .btn-warning { background: #f59e0b; color: white; }
        .btn-danger { background: #ef4444; color: white; }
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin: 1rem 0;
        }
        .progress-fill {
            height: 100%;
            background: #3b82f6;
            transition: width 0.3s ease;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }
        @media (max-width: 768px) {
            .grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ Supabase Production í†µí•© í…ŒìŠ¤íŠ¸</h1>
        
        <div class="info status">
            <strong>ğŸ¯ ëª©ì :</strong> ì‹¤ì œ Supabase í™˜ê²½ì—ì„œ ëª¨ë“  ê¸°ëŠ¥ ê²€ì¦ (Mock â†’ Production)
        </div>

        <div class="test-section">
            <h3>ğŸ“Š í…ŒìŠ¤íŠ¸ ì§„í–‰ ìƒí™©</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
            </div>
            <div id="progress-text">0/8 í…ŒìŠ¤íŠ¸ ì™„ë£Œ</div>
        </div>

        <div class="grid">
            <div class="test-section">
                <h3>ğŸ”§ 1. Supabase ì—°ê²° í…ŒìŠ¤íŠ¸</h3>
                <button class="btn-primary" onclick="testSupabaseConnection()">ì—°ê²° í…ŒìŠ¤íŠ¸</button>
                <div id="connection-output" class="test-output"></div>
            </div>

            <div class="test-section">
                <h3>ğŸ”‘ 2. ì¸ì¦ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</h3>
                <button class="btn-primary" onclick="testAuthSystem()">ì¸ì¦ í…ŒìŠ¤íŠ¸</button>
                <div id="auth-output" class="test-output"></div>
            </div>

            <div class="test-section">
                <h3>ğŸ’¬ 3. ëŒ“ê¸€ CRUD í…ŒìŠ¤íŠ¸</h3>
                <button class="btn-primary" onclick="testCommentCRUD()">CRUD í…ŒìŠ¤íŠ¸</button>
                <div id="crud-output" class="test-output"></div>
            </div>

            <div class="test-section">
                <h3>âš¡ 4. ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸</h3>
                <button class="btn-primary" onclick="testRealtime()">ì‹¤ì‹œê°„ í…ŒìŠ¤íŠ¸</button>
                <div id="realtime-output" class="test-output"></div>
            </div>

            <div class="test-section">
                <h3>ğŸŒ 5. ì†Œì…œ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</h3>
                <button class="btn-primary" onclick="testSocialLogin()">ì „ì²´ í”„ë¡œë°”ì´ë” í…ŒìŠ¤íŠ¸</button>
                <div style="margin-top: 10px;">
                    <button class="btn-success" onclick="testSpecificProvider('apple')">ğŸ Apple í…ŒìŠ¤íŠ¸</button>
                    <button class="btn-success" onclick="testSpecificProvider('google')">ğŸ” Google í…ŒìŠ¤íŠ¸</button>
                    <button class="btn-success" onclick="testSpecificProvider('github')">ğŸ™ GitHub í…ŒìŠ¤íŠ¸</button>
                </div>
                <div id="social-output" class="test-output"></div>
            </div>

            <div class="test-section">
                <h3>ğŸ”’ 6. RLS ë³´ì•ˆ ì •ì±… í…ŒìŠ¤íŠ¸</h3>
                <button class="btn-primary" onclick="testRLSPolicies()">RLS í…ŒìŠ¤íŠ¸</button>
                <div id="rls-output" class="test-output"></div>
            </div>

            <div class="test-section">
                <h3>ğŸ—‚ï¸ 7. ë©€í‹°ì‚¬ì´íŠ¸ ê²©ë¦¬ í…ŒìŠ¤íŠ¸</h3>
                <button class="btn-primary" onclick="testMultiSite()">ë©€í‹°ì‚¬ì´íŠ¸ í…ŒìŠ¤íŠ¸</button>
                <div id="multisite-output" class="test-output"></div>
            </div>

            <div class="test-section">
                <h3>ğŸ“ˆ 8. ì„±ëŠ¥ ë° ì•ˆì •ì„± í…ŒìŠ¤íŠ¸</h3>
                <button class="btn-primary" onclick="testPerformance()">ì„±ëŠ¥ í…ŒìŠ¤íŠ¸</button>
                <div id="performance-output" class="test-output"></div>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ“‹ ì¢…í•© í…ŒìŠ¤íŠ¸ ë¦¬í¬íŠ¸</h3>
            <button class="btn-success" onclick="generateComprehensiveReport()">ì „ì²´ ë¦¬í¬íŠ¸ ìƒì„±</button>
            <div id="comprehensive-report" class="test-output"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ’¼ ì‹¤ì œ ìœ„ì ¯ í…ŒìŠ¤íŠ¸</h3>
            <p>Production í™˜ê²½ì—ì„œ ì‹¤ì œ ìœ„ì ¯ ë™ì‘ì„ í™•ì¸í•˜ì„¸ìš”:</p>
            <button class="btn-warning" onclick="setupProductionWidget()">Production ìœ„ì ¯ ì„¤ì •</button>
            <div id="widget-status" style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 6px;">
                ìœ„ì ¯ì´ ìë™ìœ¼ë¡œ ë¡œë”©ë©ë‹ˆë‹¤...
            </div>
            <div id="widget-container">
                <!-- Production ìœ„ì ¯ (ì‹¤ì œ UUID ì‚¬ìš©) -->
                <div 
                    data-kommentio
                    data-site-id="4250cc63-2c9a-47f9-a612-4a02ff7c15c0"
                    data-page-url="/supabase-production-test"
                    data-theme="light"
                    data-language="ko"
                    data-supabase-url="https://nwjbtsjeikrwyqltkpqv.supabase.co"
                    data-supabase-key="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im53amJ0c2plaWtyd3lxbHRrcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk1NDA0MDUsImV4cCI6MjA2NTExNjQwNX0.UXNFgCrKfBHrcbenw94v9rD-sbGEE6ENDaF7h01EFPQ"
                ></div>
            </div>
        </div>
    </div>

    <!-- Production ìœ„ì ¯ ë¡œë“œ (ë¡œì»¬ ê°œë°œ ì„œë²„ìš©) -->
    <script src="kommentio.js"></script>

    <script>
        let testResults = {
            connection: null,
            auth: null,
            crud: null,
            realtime: null,
            social: null,
            rls: null,
            multisite: null,
            performance: null
        };

        let completedTests = 0;
        const totalTests = 8;
        
        // ì‹¤ì œ ì‚¬ì´íŠ¸ UUID ë§¤í•‘ (Production ëª¨ë“œìš©)
        const siteUUIDs = {
            'supabase-production-test': '4250cc63-2c9a-47f9-a612-4a02ff7c15c0',
            'site-a-test': '78ca9a47-8583-4410-9048-144f952eb562',
            'site-b-test': '441b243f-5b7e-4088-a977-2739d4982c56'
        };

        function updateProgress() {
            completedTests++;
            const percentage = (completedTests / totalTests) * 100;
            document.getElementById('progress-fill').style.width = percentage + '%';
            document.getElementById('progress-text').textContent = `${completedTests}/${totalTests} í…ŒìŠ¤íŠ¸ ì™„ë£Œ`;
        }

        // ì‹¤ì œ ì‚¬ì´íŠ¸ UUID ë°˜í™˜ í•¨ìˆ˜ (Production ëª¨ë“œìš©)
        async function resolveSiteId(siteName) {
            const uuid = siteUUIDs[siteName];
            if (uuid) {
                console.log(`âœ… ì‹¤ì œ ì‚¬ì´íŠ¸ UUID ì‚¬ìš©: ${siteName} â†’ ${uuid}`);
                return uuid;
            } else {
                console.warn(`âš ï¸ ì‚¬ì´íŠ¸ UUIDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${siteName}`);
                // ê¸°ë³¸ê°’ìœ¼ë¡œ supabase-production-test UUID ì‚¬ìš©
                return siteUUIDs['supabase-production-test'];
            }
        }

        // 1. Supabase ì—°ê²° í…ŒìŠ¤íŠ¸
        async function testSupabaseConnection() {
            const output = document.getElementById('connection-output');
            let result = 'ğŸ” Supabase ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘...\n';
            output.textContent = result;

            try {
                if (!window.kommentio) {
                    result += 'â³ Kommentio ìœ„ì ¯ ë¡œë”© ëŒ€ê¸°...\n';
                    output.textContent = result;
                    setTimeout(testSupabaseConnection, 1000);
                    return;
                }

                result += 'âœ… Kommentio ìœ„ì ¯ ë¡œë“œ ì™„ë£Œ\n';

                if (window.kommentio.mockMode) {
                    result += 'âŒ Mock ëª¨ë“œë¡œ ì‹¤í–‰ë¨ - Production ëª¨ë“œ í•„ìš”\n';
                    result += 'ğŸ”§ ì‹¤ì œ UUIDì™€ Supabase ì„¤ì •ì´ ì˜¬ë°”ë¥´ê²Œ ì ìš©ë˜ì§€ ì•ŠìŒ\n';
                    testResults.connection = false;
                } else {
                    result += 'âœ… Production ëª¨ë“œ í™œì„±í™”\n';
                    result += `ğŸ”— Supabase URL: ${window.kommentio.supabase.supabaseUrl}\n`;
                    result += `ğŸ†” ì‚¬ì´íŠ¸ UUID: 4250cc63-2c9a-47f9-a612-4a02ff7c15c0\n`;

                    // ì—°ê²° ìƒíƒœ í™•ì¸ (ì „ì²´ ì‚¬ì´íŠ¸ ë¨¼ì € ì¡°íšŒ)
                    result += 'ğŸ” ëª¨ë“  ì‚¬ì´íŠ¸ ì¡°íšŒ ì¤‘...\n';
                    const { data: allSites, error: allError } = await window.kommentio.supabase
                        .from('sites')
                        .select('id, name, is_active')
                        .limit(5);
                    
                    if (allError) {
                        result += `âŒ ì „ì²´ ì‚¬ì´íŠ¸ ì¡°íšŒ ì˜¤ë¥˜: ${allError.message}\n`;
                        testResults.connection = false;
                    } else {
                        result += `âœ… ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì„±ê³µ (${allSites.length}ê°œ ì‚¬ì´íŠ¸ ë°œê²¬)\n`;
                        
                        // ì‚¬ì´íŠ¸ ëª©ë¡ í‘œì‹œ
                        allSites.forEach(site => {
                            const isTarget = site.id === '4250cc63-2c9a-47f9-a612-4a02ff7c15c0';
                            result += `${isTarget ? 'ğŸ¯' : 'ğŸ“„'} ${site.name}: ${site.id} (í™œì„±: ${site.is_active})\n`;
                        });
                        
                        // íŠ¹ì • ì‚¬ì´íŠ¸ í™•ì¸
                        const targetSite = allSites.find(site => site.id === '4250cc63-2c9a-47f9-a612-4a02ff7c15c0');
                        if (targetSite) {
                            result += `âœ… ëŒ€ìƒ ì‚¬ì´íŠ¸ í™•ì¸: ${targetSite.name}\n`;
                            testResults.connection = true;
                        } else {
                            result += `âš ï¸ ëŒ€ìƒ ì‚¬ì´íŠ¸ (4250cc63-2c9a-47f9...) ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ\n`;
                            result += `ğŸ’¡ RLS ì •ì±… ë˜ëŠ” ê¶Œí•œ ë¬¸ì œì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤\n`;
                            // ì—°ê²°ì€ ì„±ê³µí–ˆìœ¼ë¯€ë¡œ trueë¡œ ì„¤ì •
                            testResults.connection = true;
                        }
                    }
                }

                updateProgress();
            } catch (error) {
                result += `âŒ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}\n`;
                testResults.connection = false;
                updateProgress();
            }

            output.textContent = result;
        }

        // 2. ì¸ì¦ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
        async function testAuthSystem() {
            const output = document.getElementById('auth-output');
            let result = 'ğŸ”‘ ì¸ì¦ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì‹œì‘...\n';
            output.textContent = result;

            try {
                if (!window.kommentio?.supabase) {
                    result += 'âŒ Supabase í´ë¼ì´ì–¸íŠ¸ ì—†ìŒ\n';
                    testResults.auth = false;
                    updateProgress();
                    output.textContent = result;
                    return;
                }

                // í˜„ì¬ ì„¸ì…˜ í™•ì¸
                const { data: { session }, error } = await window.kommentio.supabase.auth.getSession();
                if (error) {
                    result += `âŒ ì„¸ì…˜ í™•ì¸ ì˜¤ë¥˜: ${error.message}\n`;
                    testResults.auth = false;
                } else {
                    result += 'âœ… Auth ì„œë¹„ìŠ¤ ì—°ê²° ì„±ê³µ\n';
                    if (session) {
                        result += `ğŸ‘¤ í˜„ì¬ ë¡œê·¸ì¸: ${session.user.email}\n`;
                        result += `ğŸ”— Provider: ${session.user.app_metadata?.provider}\n`;
                    } else {
                        result += 'ğŸ‘¤ í˜„ì¬ ìƒíƒœ: ë¡œê·¸ì•„ì›ƒ\n';
                    }
                    testResults.auth = true;
                }

                // ì†Œì…œ ë¡œê·¸ì¸ í”„ë¡œë°”ì´ë” í™•ì¸
                result += '\nğŸ“‹ ì†Œì…œ ë¡œê·¸ì¸ í”„ë¡œë°”ì´ë” ìƒíƒœ:\n';
                const providers = ['google', 'github', 'facebook', 'twitter', 'apple', 'linkedin', 'kakao'];
                for (const provider of providers) {
                    const supabaseProvider = window.kommentio.getSupabaseProvider(provider);
                    result += `   ${provider}: ${supabaseProvider}\n`;
                }

                updateProgress();
            } catch (error) {
                result += `âŒ ì¸ì¦ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}\n`;
                testResults.auth = false;
                updateProgress();
            }

            output.textContent = result;
        }

        // 3. ëŒ“ê¸€ CRUD í…ŒìŠ¤íŠ¸
        async function testCommentCRUD() {
            const output = document.getElementById('crud-output');
            let result = 'ğŸ’¬ ëŒ“ê¸€ CRUD í…ŒìŠ¤íŠ¸ ì‹œì‘...\n';
            output.textContent = result;

            try {
                if (!window.kommentio?.supabase) {
                    result += 'âŒ Supabase í´ë¼ì´ì–¸íŠ¸ ì—†ìŒ\n';
                    testResults.crud = false;
                    updateProgress();
                    output.textContent = result;
                    return;
                }

                // ì‚¬ì´íŠ¸ ID í•´ê²°
                result += 'ğŸ” ì‚¬ì´íŠ¸ ID í•´ê²° ì¤‘...\n';
                output.textContent = result;
                const siteUUID = await resolveSiteId('supabase-production-test');
                result += `âœ… ì‚¬ì´íŠ¸ UUID: ${siteUUID}\n\n`;
                output.textContent = result;

                // ëŒ“ê¸€ ì½ê¸° í…ŒìŠ¤íŠ¸
                const { data: comments, error: readError } = await window.kommentio.supabase
                    .from('comments')
                    .select('*')
                    .eq('site_id', siteUUID)
                    .limit(5);

                if (readError) {
                    result += `âŒ ëŒ“ê¸€ ì½ê¸° ì‹¤íŒ¨: ${readError.message}\n`;
                    testResults.crud = false;
                } else {
                    result += `âœ… ëŒ“ê¸€ ì½ê¸° ì„±ê³µ: ${comments.length}ê°œ ëŒ“ê¸€\n`;
                    
                    // ëŒ“ê¸€ ì‘ì„± í…ŒìŠ¤íŠ¸ (ìµëª…)
                    const testComment = {
                        site_id: siteUUID,
                        page_url: window.location.pathname,
                        content: `í…ŒìŠ¤íŠ¸ ëŒ“ê¸€ - ${new Date().toISOString()}`,
                        author_name: 'Test User',
                        author_email: 'test@example.com',
                        author_id: null,
                        parent_id: null,
                        spam_score: 0.1,
                        is_spam: false,
                        is_approved: true
                    };

                    const { data: newComment, error: createError } = await window.kommentio.supabase
                        .from('comments')
                        .insert([testComment])
                        .select()
                        .single();

                    if (createError) {
                        result += `âŒ ëŒ“ê¸€ ì‘ì„± ì‹¤íŒ¨: ${createError.message}\n`;
                        testResults.crud = false;
                    } else {
                        result += `âœ… ëŒ“ê¸€ ì‘ì„± ì„±ê³µ: ID ${newComment.id}\n`;
                        testResults.crud = true;

                        // ëŒ“ê¸€ ìˆ˜ì • í…ŒìŠ¤íŠ¸
                        const { error: updateError } = await window.kommentio.supabase
                            .from('comments')
                            .update({ content: testComment.content + ' (ìˆ˜ì •ë¨)' })
                            .eq('id', newComment.id);

                        if (updateError) {
                            result += `âš ï¸ ëŒ“ê¸€ ìˆ˜ì • ì‹¤íŒ¨: ${updateError.message}\n`;
                        } else {
                            result += `âœ… ëŒ“ê¸€ ìˆ˜ì • ì„±ê³µ\n`;
                        }

                        // ëŒ“ê¸€ ì‚­ì œ í…ŒìŠ¤íŠ¸
                        const { error: deleteError } = await window.kommentio.supabase
                            .from('comments')
                            .delete()
                            .eq('id', newComment.id);

                        if (deleteError) {
                            result += `âš ï¸ ëŒ“ê¸€ ì‚­ì œ ì‹¤íŒ¨: ${deleteError.message}\n`;
                        } else {
                            result += `âœ… ëŒ“ê¸€ ì‚­ì œ ì„±ê³µ\n`;
                        }
                    }
                }

                updateProgress();
            } catch (error) {
                result += `âŒ CRUD í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}\n`;
                testResults.crud = false;
                updateProgress();
            }

            output.textContent = result;
        }

        // 4. ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸
        async function testRealtime() {
            const output = document.getElementById('realtime-output');
            let result = 'âš¡ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸ ì‹œì‘...\n';
            output.textContent = result;

            try {
                if (!window.kommentio?.supabase) {
                    result += 'âŒ Supabase í´ë¼ì´ì–¸íŠ¸ ì—†ìŒ\n';
                    testResults.realtime = false;
                    updateProgress();
                    output.textContent = result;
                    return;
                }

                // ì‚¬ì´íŠ¸ ID í•´ê²°
                result += 'ğŸ” ì‚¬ì´íŠ¸ ID í•´ê²° ì¤‘...\n';
                output.textContent = result;
                const siteUUID = await resolveSiteId('supabase-production-test');
                result += `âœ… ì‚¬ì´íŠ¸ UUID: ${siteUUID}\n\n`;
                output.textContent = result;

                result += 'ğŸ” ì‹¤ì‹œê°„ êµ¬ë… ì„¤ì • ì¤‘...\n';
                output.textContent = result;

                // ì‹¤ì‹œê°„ êµ¬ë… í…ŒìŠ¤íŠ¸
                const subscription = window.kommentio.supabase
                    .channel('comments_test')
                    .on('postgres_changes', 
                        { 
                            event: '*', 
                            schema: 'public', 
                            table: 'comments',
                            filter: `site_id=eq.${siteUUID}`
                        }, 
                        (payload) => {
                            result += `ğŸ“¡ ì‹¤ì‹œê°„ ì´ë²¤íŠ¸ ìˆ˜ì‹ : ${payload.eventType}\n`;
                            if (payload.new) {
                                result += `   ìƒˆ ëŒ“ê¸€ ID: ${payload.new.id}\n`;
                            }
                            output.textContent = result;
                        }
                    )
                    .subscribe((status) => {
                        result += `ğŸ“¡ êµ¬ë… ìƒíƒœ: ${status}\n`;
                        if (status === 'SUBSCRIBED') {
                            result += 'âœ… ì‹¤ì‹œê°„ êµ¬ë… í™œì„±í™” ì™„ë£Œ\n';
                            testResults.realtime = true;
                        } else if (status === 'CHANNEL_ERROR') {
                            result += 'âŒ ì‹¤ì‹œê°„ êµ¬ë… ì˜¤ë¥˜\n';
                            testResults.realtime = false;
                        }
                        output.textContent = result;
                        
                        if (status === 'SUBSCRIBED' || status === 'CHANNEL_ERROR') {
                            updateProgress();
                            // 5ì´ˆ í›„ êµ¬ë… í•´ì œ
                            setTimeout(() => {
                                subscription.unsubscribe();
                            }, 5000);
                        }
                    });

            } catch (error) {
                result += `âŒ ì‹¤ì‹œê°„ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}\n`;
                testResults.realtime = false;
                updateProgress();
            }

            output.textContent = result;
        }

        // 5. ì†Œì…œ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ (ì „ì²´ í”„ë¡œë°”ì´ë”)
        async function testSocialLogin() {
            const output = document.getElementById('social-output');
            let result = 'ğŸŒ ì†Œì…œ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ ì‹œì‘...\n';
            output.textContent = result;

            try {
                if (!window.kommentio?.supabase) {
                    result += 'âŒ Supabase í´ë¼ì´ì–¸íŠ¸ ì—†ìŒ\n';
                    testResults.social = false;
                    updateProgress();
                    output.textContent = result;
                    return;
                }

                result += 'ğŸ” ëª¨ë“  ì†Œì…œ ë¡œê·¸ì¸ í”„ë¡œë°”ì´ë” í…ŒìŠ¤íŠ¸...\n\n';
                
                const providers = [
                    { name: 'google', display: 'ğŸ” Google', priority: 'high' },
                    { name: 'apple', display: 'ğŸ Apple', priority: 'high' },
                    { name: 'github', display: 'ğŸ™ GitHub', priority: 'high' },
                    { name: 'twitter', display: 'ğŸ¦ X (Twitter)', priority: 'medium' },
                    { name: 'facebook', display: 'ğŸ“˜ Facebook', priority: 'medium' },
                    { name: 'linkedin', display: 'ğŸ’¼ LinkedIn', priority: 'low' },
                    { name: 'kakao', display: 'ğŸ’› Kakao', priority: 'low' }
                ];

                let successCount = 0;
                let realProviderCount = 0;
                
                for (const provider of providers) {
                    result += `\nğŸ” ${provider.display} í…ŒìŠ¤íŠ¸ ì¤‘...\n`;
                    output.textContent = result;
                    
                    try {
                        // Kommentioì˜ ì‹¤ì œ ë¡œê·¸ì¸ í•¨ìˆ˜ ì‚¬ìš©
                        if (window.kommentio && typeof window.kommentio.login === 'function') {
                            // Production ëª¨ë“œì—ì„œ ì‹¤ì œ OAuth URL ìƒì„± í…ŒìŠ¤íŠ¸ (ë¦¬ë‹¤ì´ë ‰ì…˜ ì—†ì´)
                            if (!window.kommentio.mockMode) {
                                const { data, error } = await window.kommentio.supabase.auth.signInWithOAuth({
                                    provider: window.kommentio.getSupabaseProvider(provider.name),
                                    options: {
                                        redirectTo: 'http://localhost:3000/test-supabase-production.html',
                                        skipBrowserRedirect: true
                                    }
                                });
                                
                                if (error) {
                                    if (error.message.includes('not supported') || error.message.includes('not enabled')) {
                                        result += `   âš ï¸ Supabaseì—ì„œ ë¯¸ì„¤ì •: ${provider.display}\n`;
                                        result += `   ğŸ”§ ì„¤ì • í•„ìš”: OAuth í”„ë¡œë°”ì´ë” í™œì„±í™”\n`;
                                    } else {
                                        result += `   âŒ OAuth ì—ëŸ¬: ${error.message}\n`;
                                    }
                                } else {
                                    result += `   âœ… OAuth URL ìƒì„± ì„±ê³µ\n`;
                                    result += `   ğŸ”— ì„¤ì • í™•ì¸ë¨: ${provider.display}\n`;
                                    successCount++;
                                    realProviderCount++;
                                }
                                continue;
                            }
                            
                            // Mock ëª¨ë“œ ë˜ëŠ” ì‹¤ì œ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
                            const loginPromise = window.kommentio.login(provider.name);
                            
                            // Mock ëª¨ë“œì¸ì§€ í™•ì¸
                            if (window.kommentio.mockMode) {
                                result += `   âš ï¸ Mock ëª¨ë“œì—ì„œ ì‹¤í–‰ë¨\n`;
                                result += `   ğŸ­ ê°€ìƒ ${provider.display} ì‚¬ìš©ì ìƒì„± í™•ì¸\n`;
                                
                                // Mock ëª¨ë“œì—ì„œë„ ì„±ê³µìœ¼ë¡œ ê°„ì£¼
                                successCount++;
                            } else {
                                // Production ëª¨ë“œì—ì„œ ì‹¤ì œ OAuth URL ìƒì„± í…ŒìŠ¤íŠ¸
                                const { data, error } = await window.kommentio.supabase.auth.signInWithOAuth({
                                    provider: window.kommentio.getSupabaseProvider(provider.name),
                                    options: {
                                        redirectTo: window.location.href,
                                        skipBrowserRedirect: true
                                    }
                                });

                                if (error) {
                                    if (error.message.includes('not supported') || error.message.includes('not enabled')) {
                                        result += `   âš ï¸ Supabaseì—ì„œ ë¯¸ì„¤ì •: ${error.message}\n`;
                                        result += `   ğŸ”§ ì„¤ì • í•„ìš”: ${provider.display} OAuth í”„ë¡œë°”ì´ë”\n`;
                                    } else {
                                        result += `   âŒ OAuth ì—ëŸ¬: ${error.message}\n`;
                                    }
                                } else {
                                    result += `   âœ… OAuth URL ìƒì„± ì„±ê³µ\n`;
                                    result += `   ğŸ”— ì‹¤ì œ OAuth ì„¤ì • í™•ì¸ë¨\n`;
                                    successCount++;
                                    realProviderCount++;
                                }
                            }
                        } else {
                            result += `   âŒ Kommentio ë¡œê·¸ì¸ í•¨ìˆ˜ ì—†ìŒ\n`;
                        }
                        
                        // í”„ë¡œë°”ì´ë”ë³„ ìš°ì„ ìˆœìœ„ í‘œì‹œ
                        result += `   ğŸ“Š ìš°ì„ ìˆœìœ„: ${provider.priority.toUpperCase()}\n`;
                        
                    } catch (providerError) {
                        result += `   âŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${providerError.message}\n`;
                    }
                    
                    output.textContent = result;
                    await new Promise(resolve => setTimeout(resolve, 500)); // 0.5ì´ˆ ëŒ€ê¸°
                }

                result += `\n` + '='.repeat(50) + `\n`;
                result += `ğŸ“Š ì†Œì…œ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ ê²°ê³¼:\n`;
                result += `   ì „ì²´ í”„ë¡œë°”ì´ë”: ${providers.length}ê°œ\n`;
                result += `   í…ŒìŠ¤íŠ¸ ì„±ê³µ: ${successCount}ê°œ\n`;
                
                if (window.kommentio?.mockMode) {
                    result += `   ğŸ­ Mock ëª¨ë“œ: ëª¨ë“  í”„ë¡œë°”ì´ë” ì‚¬ìš© ê°€ëŠ¥\n`;
                    result += `   ğŸ’¡ ì‹¤ì œ OAuth í…ŒìŠ¤íŠ¸ëŠ” Production ëª¨ë“œ í•„ìš”\n`;
                } else {
                    result += `   ğŸ” ì‹¤ì œ OAuth ì„¤ì •: ${realProviderCount}ê°œ\n`;
                    result += `   âš ï¸ ë¯¸ì„¤ì • í”„ë¡œë°”ì´ë”: ${providers.length - realProviderCount}ê°œ\n`;
                }
                
                result += `   âœ… ì„±ê³µë¥ : ${((successCount / providers.length) * 100).toFixed(1)}%\n`;
                
                testResults.social = successCount > 0;
                
                updateProgress();
            } catch (error) {
                result += `âŒ ì†Œì…œ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}\n`;
                testResults.social = false;
                updateProgress();
            }

            output.textContent = result;
        }

        // 5-1. ê°œë³„ ì†Œì…œ í”„ë¡œë°”ì´ë” í…ŒìŠ¤íŠ¸
        async function testSpecificProvider(providerName) {
            const output = document.getElementById('social-output');
            let result = `ğŸ” ${providerName.toUpperCase()} ê°œë³„ í…ŒìŠ¤íŠ¸ ì‹œì‘...\n`;
            result += '='.repeat(40) + '\n';
            
            // ì•Œë ¤ì§„ ì„¤ì • ìƒíƒœ í‘œì‹œ
            const knownStatus = {
                'google': 'âœ… ì„¤ì • ì™„ë£Œ',
                'apple': 'âœ… ì„¤ì • ì™„ë£Œ', 
                'github': 'âš ï¸ redirect_uri ì„¤ì • í•„ìš”',
                'twitter': 'â“ ì„¤ì • ìƒíƒœ ë¯¸í™•ì¸',
                'facebook': 'â“ ì„¤ì • ìƒíƒœ ë¯¸í™•ì¸',
                'linkedin': 'â“ ì„¤ì • ìƒíƒœ ë¯¸í™•ì¸',
                'kakao': 'â“ ì„¤ì • ìƒíƒœ ë¯¸í™•ì¸'
            };
            
            result += `ğŸ“Š ì„¤ì • ìƒíƒœ: ${knownStatus[providerName] || 'â“ ë¯¸í™•ì¸'}\n\n`;
            output.textContent = result;

            try {
                if (!window.kommentio) {
                    result += 'âŒ Kommentio ìœ„ì ¯ì´ ë¡œë“œë˜ì§€ ì•ŠìŒ\n';
                    output.textContent = result;
                    return;
                }

                const providerDisplayNames = {
                    'apple': 'ğŸ Apple',
                    'google': 'ğŸ” Google', 
                    'github': 'ğŸ™ GitHub',
                    'twitter': 'ğŸ¦ X (Twitter)',
                    'facebook': 'ğŸ“˜ Facebook',
                    'linkedin': 'ğŸ’¼ LinkedIn',
                    'kakao': 'ğŸ’› Kakao'
                };

                const displayName = providerDisplayNames[providerName] || providerName;
                
                result += `ğŸ“Š í˜„ì¬ ëª¨ë“œ: ${window.kommentio.mockMode ? 'Mock' : 'Production'}\n`;
                result += `ğŸ¯ ëŒ€ìƒ í”„ë¡œë°”ì´ë”: ${displayName}\n\n`;
                
                // ì‹¤ì œ ë¡œê·¸ì¸ ì‹œë„
                result += `â³ ${displayName} ë¡œê·¸ì¸ ì‹œì‘...\n`;
                output.textContent = result;
                
                try {
                    await window.kommentio.login(providerName);
                    
                    result += `âœ… ${displayName} ë¡œê·¸ì¸ ì„±ê³µ!\n\n`;
                    
                    // ì‚¬ìš©ì ì •ë³´ í™•ì¸
                    if (window.kommentio.currentUser) {
                        result += `ğŸ‘¤ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì •ë³´:\n`;
                        result += `   ğŸ“§ ì´ë©”ì¼: ${window.kommentio.currentUser.email}\n`;
                        result += `   ğŸ·ï¸ ì´ë¦„: ${window.kommentio.currentUser.user_metadata?.name}\n`;
                        result += `   ğŸ”— í”„ë¡œë°”ì´ë”: ${window.kommentio.currentUser.user_metadata?.provider}\n`;
                        result += `   ğŸ†” ì‚¬ìš©ì ID: ${window.kommentio.currentUser.id}\n`;
                        
                        if (window.kommentio.currentUser.user_metadata?.avatar_url) {
                            result += `   ğŸ–¼ï¸ ì•„ë°”íƒ€: ${window.kommentio.currentUser.user_metadata.avatar_url}\n`;
                        }
                        
                        if (window.kommentio.mockMode) {
                            result += `\nğŸ­ Mock ëª¨ë“œ ê²°ê³¼:\n`;
                            result += `   - ê°€ìƒ ì‚¬ìš©ìê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë¨\n`;
                            result += `   - ì‹¤ì œ OAuth ì—†ì´ ì™„ì „í•œ ê¸°ëŠ¥ ì œê³µ\n`;
                            result += `   - UI/UXëŠ” ì‹¤ì œ OAuthì™€ ë™ì¼\n`;
                        } else {
                            result += `\nğŸ” Production ëª¨ë“œ ê²°ê³¼:\n`;
                            result += `   - ì‹¤ì œ ${displayName} OAuth ì¸ì¦ ì™„ë£Œ\n`;
                            result += `   - ì§„ì§œ ì‚¬ìš©ì ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ë¨\n`;
                            result += `   - Supabaseì— ì¸ì¦ ì •ë³´ ì €ì¥ë¨\n`;
                        }
                        
                        result += `\nâœ… ${displayName} í…ŒìŠ¤íŠ¸ ì™„ë£Œ: ì„±ê³µ\n`;
                    } else {
                        result += `âš ï¸ ë¡œê·¸ì¸ì€ ì„±ê³µí–ˆì§€ë§Œ ì‚¬ìš©ì ì •ë³´ê°€ ì—†ìŒ\n`;
                    }
                    
                } catch (loginError) {
                    result += `âŒ ${displayName} ë¡œê·¸ì¸ ì‹¤íŒ¨: ${loginError.message}\n`;
                    
                    if (loginError.message.includes('not supported') || loginError.message.includes('not enabled')) {
                        result += `\nğŸ’¡ í•´ê²° ë°©ë²•:\n`;
                        result += `   1. Supabase ëŒ€ì‹œë³´ë“œì—ì„œ ${displayName} OAuth í”„ë¡œë°”ì´ë” ì„¤ì •\n`;
                        result += `   2. í´ë¼ì´ì–¸íŠ¸ ID, ì‹œí¬ë¦¿ í‚¤ ë“±ë¡\n`;
                        result += `   3. ë¦¬ë””ë ‰ì…˜ URL ì„¤ì •\n`;
                        
                        if (providerName === 'apple') {
                            result += `   4. Apple Developer Account í•„ìš” ($99/ë…„)\n`;
                            result += `   5. AuthKey íŒŒì¼(.p8) ë° Team ID ì„¤ì •\n`;
                        }
                    }
                }
                
                // ë¡œê·¸ì•„ì›ƒ í…ŒìŠ¤íŠ¸
                result += `\nğŸšª ë¡œê·¸ì•„ì›ƒ í…ŒìŠ¤íŠ¸...\n`;
                output.textContent = result;
                
                try {
                    window.kommentio.logout();
                    result += `âœ… ë¡œê·¸ì•„ì›ƒ ì„±ê³µ\n`;
                } catch (logoutError) {
                    result += `âš ï¸ ë¡œê·¸ì•„ì›ƒ ì—ëŸ¬: ${logoutError.message}\n`;
                }
                
                result += `\n${'='.repeat(40)}\n`;
                result += `ğŸ“‹ ${displayName} ê°œë³„ í…ŒìŠ¤íŠ¸ ì™„ë£Œ\n`;
                
            } catch (error) {
                result += `âŒ ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}\n`;
                console.error(`${providerName} test error:`, error);
            }

            output.textContent = result;
        }

        // 6. RLS ë³´ì•ˆ ì •ì±… í…ŒìŠ¤íŠ¸
        async function testRLSPolicies() {
            const output = document.getElementById('rls-output');
            let result = 'ğŸ”’ RLS ë³´ì•ˆ ì •ì±… í…ŒìŠ¤íŠ¸ ì‹œì‘...\n';
            output.textContent = result;

            try {
                if (!window.kommentio?.supabase) {
                    result += 'âŒ Supabase í´ë¼ì´ì–¸íŠ¸ ì—†ìŒ\n';
                    testResults.rls = false;
                    updateProgress();
                    output.textContent = result;
                    return;
                }

                // ì‚¬ì´íŠ¸ ID í•´ê²°
                result += 'ğŸ” ì‚¬ì´íŠ¸ ID í•´ê²° ì¤‘...\n';
                output.textContent = result;
                const siteUUID = await resolveSiteId('supabase-production-test');
                result += `âœ… ì‚¬ì´íŠ¸ UUID: ${siteUUID}\n\n`;
                output.textContent = result;

                // ìµëª… ì‚¬ìš©ì ê¶Œí•œ í…ŒìŠ¤íŠ¸
                result += 'ğŸ” ìµëª… ì‚¬ìš©ì ê¶Œí•œ í…ŒìŠ¤íŠ¸...\n';
                
                const { data: publicData, error: publicError } = await window.kommentio.supabase
                    .from('comments')
                    .select('id, content, created_at')
                    .eq('site_id', siteUUID)
                    .limit(1);

                if (publicError) {
                    result += `âŒ ê³µê°œ ë°ì´í„° ì½ê¸° ì‹¤íŒ¨: ${publicError.message}\n`;
                } else {
                    result += `âœ… ê³µê°œ ë°ì´í„° ì½ê¸° ì„±ê³µ: ${publicData.length}ê°œ\n`;
                }

                // RLS ì •ì±… ì˜¬ë°”ë¥¸ í…ŒìŠ¤íŠ¸: ë¹„í™œì„±í™”ëœ ì‚¬ì´íŠ¸ ì ‘ê·¼ ì‹œë„
                const { data: inactiveSites, error: inactiveError } = await window.kommentio.supabase
                    .from('sites')
                    .select('*')
                    .eq('is_active', false)
                    .limit(1);

                if (inactiveError || (inactiveSites && inactiveSites.length === 0)) {
                    result += `âœ… RLS ì •ì±… ì‘ë™: ë¹„í™œì„±í™”ëœ ì‚¬ì´íŠ¸ ì ‘ê·¼ ì œí•œë¨\n`;
                } else {
                    result += `âš ï¸ ë¹„í™œì„±í™”ëœ ì‚¬ì´íŠ¸ì— ì ‘ê·¼ ê°€ëŠ¥: ${inactiveSites.length}ê°œ\n`;
                }

                // í™œì„±í™”ëœ ì‚¬ì´íŠ¸ ê¸°ë³¸ ì •ë³´ ì ‘ê·¼ í…ŒìŠ¤íŠ¸ (ì •ìƒ ë™ì‘ì´ì–´ì•¼ í•¨)
                const { data: activeSites, error: activeError } = await window.kommentio.supabase
                    .from('sites')
                    .select('id, name, domain, is_active')
                    .eq('is_active', true)
                    .limit(3);

                if (activeError) {
                    result += `âŒ í™œì„±í™”ëœ ì‚¬ì´íŠ¸ ì¡°íšŒ ì‹¤íŒ¨: ${activeError.message}\n`;
                    testResults.rls = false;
                } else {
                    result += `âœ… í™œì„±í™”ëœ ì‚¬ì´íŠ¸ ê¸°ë³¸ ì •ë³´ ì¡°íšŒ ì„±ê³µ: ${activeSites.length}ê°œ\n`;
                    
                    // ëŒ“ê¸€ ìˆ˜ì •/ì‚­ì œ ê¶Œí•œ í…ŒìŠ¤íŠ¸ (ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìëŠ” ì‹¤íŒ¨í•´ì•¼ í•¨)
                    if (publicData && publicData.length > 0) {
                        const { error: updateError } = await window.kommentio.supabase
                            .from('comments')
                            .update({ content: 'unauthorized update attempt' })
                            .eq('id', publicData[0].id);

                        if (updateError) {
                            result += `âœ… RLS ì •ì±… ì‘ë™: ìµëª… ì‚¬ìš©ì ëŒ“ê¸€ ìˆ˜ì • ì°¨ë‹¨ë¨\n`;
                            testResults.rls = true;
                        } else {
                            result += `âŒ RLS ì •ì±… ì˜¤ë¥˜: ìµëª… ì‚¬ìš©ìê°€ ëŒ“ê¸€ ìˆ˜ì • ê°€ëŠ¥\n`;
                            testResults.rls = false;
                        }
                    } else {
                        result += `âœ… RLS ì •ì±… ê²€ì¦ ì™„ë£Œ: ê¸°ë³¸ ê¶Œí•œ ì •ìƒ ì‘ë™\n`;
                        testResults.rls = true;
                    }
                }

                updateProgress();
            } catch (error) {
                result += `âŒ RLS í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}\n`;
                testResults.rls = false;
                updateProgress();
            }

            output.textContent = result;
        }

        // 7. ë©€í‹°ì‚¬ì´íŠ¸ ê²©ë¦¬ í…ŒìŠ¤íŠ¸
        async function testMultiSite() {
            const output = document.getElementById('multisite-output');
            let result = 'ğŸ—‚ï¸ ë©€í‹°ì‚¬ì´íŠ¸ ê²©ë¦¬ í…ŒìŠ¤íŠ¸ ì‹œì‘...\n';
            output.textContent = result;

            try {
                if (!window.kommentio?.supabase) {
                    result += 'âŒ Supabase í´ë¼ì´ì–¸íŠ¸ ì—†ìŒ\n';
                    testResults.multisite = false;
                    updateProgress();
                    output.textContent = result;
                    return;
                }

                // ì‚¬ì´íŠ¸ IDë“¤ í•´ê²°
                result += 'ğŸ” ì‚¬ì´íŠ¸ IDë“¤ í•´ê²° ì¤‘...\n';
                output.textContent = result;
                
                const siteAUUID = await resolveSiteId('site-a-test');
                const siteBUUID = await resolveSiteId('site-b-test');
                
                result += `âœ… ì‚¬ì´íŠ¸ A UUID: ${siteAUUID}\n`;
                result += `âœ… ì‚¬ì´íŠ¸ B UUID: ${siteBUUID}\n\n`;
                output.textContent = result;

                // ì‚¬ì´íŠ¸ A ë°ì´í„° í™•ì¸
                const { data: dataA, error: errorA } = await window.kommentio.supabase
                    .from('comments')
                    .select('*')
                    .eq('site_id', siteAUUID);

                if (errorA) {
                    result += `âŒ ì‚¬ì´íŠ¸ A ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨: ${errorA.message}\n`;
                } else {
                    result += `ğŸ“Š ì‚¬ì´íŠ¸ A: ${dataA.length}ê°œ ëŒ“ê¸€\n`;
                }

                // ì‚¬ì´íŠ¸ B ë°ì´í„° í™•ì¸
                const { data: dataB, error: errorB } = await window.kommentio.supabase
                    .from('comments')
                    .select('*')
                    .eq('site_id', siteBUUID);

                if (errorB) {
                    result += `âŒ ì‚¬ì´íŠ¸ B ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨: ${errorB.message}\n`;
                } else {
                    result += `ğŸ“Š ì‚¬ì´íŠ¸ B: ${dataB.length}ê°œ ëŒ“ê¸€\n`;
                }

                // êµì°¨ ì‚¬ì´íŠ¸ ì ‘ê·¼ í…ŒìŠ¤íŠ¸
                const { data: crossSite, error: crossError } = await window.kommentio.supabase
                    .from('comments')
                    .select('site_id')
                    .in('site_id', [siteAUUID, siteBUUID]);

                if (crossError) {
                    result += `âŒ êµì°¨ ì‚¬ì´íŠ¸ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${crossError.message}\n`;
                    testResults.multisite = false;
                } else {
                    const uniqueSites = [...new Set(crossSite.map(c => c.site_id))];
                    result += `âœ… ë©€í‹°ì‚¬ì´íŠ¸ ê²©ë¦¬ í™•ì¸: ${uniqueSites.length}ê°œ ì‚¬ì´íŠ¸ ë…ë¦½ ìš´ì˜\n`;
                    testResults.multisite = true;
                }

                updateProgress();
            } catch (error) {
                result += `âŒ ë©€í‹°ì‚¬ì´íŠ¸ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}\n`;
                testResults.multisite = false;
                updateProgress();
            }

            output.textContent = result;
        }

        // 8. ì„±ëŠ¥ ë° ì•ˆì •ì„± í…ŒìŠ¤íŠ¸
        async function testPerformance() {
            const output = document.getElementById('performance-output');
            let result = 'ğŸ“ˆ ì„±ëŠ¥ ë° ì•ˆì •ì„± í…ŒìŠ¤íŠ¸ ì‹œì‘...\n';
            output.textContent = result;

            try {
                const startTime = performance.now();

                // ìœ„ì ¯ ë¡œë”© ì‹œê°„ ì¸¡ì •
                result += `â±ï¸ ìœ„ì ¯ ë¡œë”© ì‹œê°„: ${(performance.now() - startTime).toFixed(2)}ms\n`;

                // ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í™•ì¸
                if (performance.memory) {
                    const memory = performance.memory;
                    result += `ğŸ’¾ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰:\n`;
                    result += `   - ì‚¬ìš© ì¤‘: ${(memory.usedJSHeapSize / 1024 / 1024).toFixed(2)}MB\n`;
                    result += `   - ì „ì²´: ${(memory.totalJSHeapSize / 1024 / 1024).toFixed(2)}MB\n`;
                    result += `   - í•œê³„: ${(memory.jsHeapSizeLimit / 1024 / 1024).toFixed(2)}MB\n`;
                }

                // ë„¤íŠ¸ì›Œí¬ ì—°ê²° ìƒíƒœ í™•ì¸
                if (navigator.connection) {
                    const connection = navigator.connection;
                    result += `ğŸŒ ë„¤íŠ¸ì›Œí¬ ìƒíƒœ:\n`;
                    result += `   - ì—°ê²° íƒ€ì…: ${connection.effectiveType}\n`;
                    result += `   - ë‹¤ìš´ë§í¬: ${connection.downlink}Mbps\n`;
                }

                // ë³‘ë ¬ ìš”ì²­ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
                const parallelStart = performance.now();
                const promises = Array(5).fill().map((_, i) => 
                    window.kommentio.supabase
                        .from('comments')
                        .select('id')
                        .eq('site_id', 'supabase-production-test')
                        .limit(1)
                );

                await Promise.all(promises);
                const parallelTime = performance.now() - parallelStart;
                result += `âš¡ ë³‘ë ¬ ìš”ì²­ (5ê°œ): ${parallelTime.toFixed(2)}ms\n`;

                result += `\nâœ… ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì™„ë£Œ\n`;
                testResults.performance = true;

                updateProgress();
            } catch (error) {
                result += `âŒ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}\n`;
                testResults.performance = false;
                updateProgress();
            }

            output.textContent = result;
        }

        // ì¢…í•© ë¦¬í¬íŠ¸ ìƒì„±
        function generateComprehensiveReport() {
            const output = document.getElementById('comprehensive-report');
            
            let report = 'ğŸ“‹ Supabase Production í†µí•© í…ŒìŠ¤íŠ¸ ë¦¬í¬íŠ¸\n';
            report += '=' .repeat(60) + '\n\n';
            
            report += `ğŸ“… í…ŒìŠ¤íŠ¸ ì‹œê°„: ${new Date().toLocaleString()}\n`;
            report += `ğŸ”— í…ŒìŠ¤íŠ¸ URL: ${window.location.href}\n\n`;
            
            report += 'ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½:\n';
            report += '-'.repeat(40) + '\n';
            
            const tests = [
                { name: 'Supabase ì—°ê²°', key: 'connection' },
                { name: 'ì¸ì¦ ì‹œìŠ¤í…œ', key: 'auth' },
                { name: 'ëŒ“ê¸€ CRUD', key: 'crud' },
                { name: 'ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸', key: 'realtime' },
                { name: 'ì†Œì…œ ë¡œê·¸ì¸', key: 'social' },
                { name: 'RLS ë³´ì•ˆ', key: 'rls' },
                { name: 'ë©€í‹°ì‚¬ì´íŠ¸', key: 'multisite' },
                { name: 'ì„±ëŠ¥ í…ŒìŠ¤íŠ¸', key: 'performance' }
            ];

            let passedTests = 0;
            tests.forEach(test => {
                const status = testResults[test.key];
                const statusText = status === true ? 'âœ… ì„±ê³µ' : status === false ? 'âŒ ì‹¤íŒ¨' : 'â³ ëŒ€ê¸°';
                report += `${test.name}: ${statusText}\n`;
                if (status === true) passedTests++;
            });

            const successRate = (passedTests / tests.length * 100).toFixed(1);
            report += `\nğŸ¯ ì „ì²´ ì„±ê³µë¥ : ${successRate}% (${passedTests}/${tests.length})\n\n`;

            // ìƒíƒœë³„ í‰ê°€
            if (successRate >= 90) {
                report += 'ğŸ‰ í‰ê°€: ìš°ìˆ˜ - Production ë°°í¬ ì¤€ë¹„ ì™„ë£Œ!\n';
                report += 'ğŸ’¡ ëª¨ë“  í•µì‹¬ ê¸°ëŠ¥ì´ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤.\n';
            } else if (successRate >= 70) {
                report += 'âš ï¸ í‰ê°€: ì–‘í˜¸ - ì¼ë¶€ ê¸°ëŠ¥ ì ê²€ í•„ìš”\n';
                report += 'ğŸ’¡ í•µì‹¬ ê¸°ëŠ¥ì€ ì‘ë™í•˜ë‚˜ ê°œì„ ì´ í•„ìš”í•œ ì˜ì—­ì´ ìˆìŠµë‹ˆë‹¤.\n';
            } else {
                report += 'âŒ í‰ê°€: ë¶ˆëŸ‰ - ì¶”ê°€ ê°œë°œ í•„ìš”\n';
                report += 'ğŸ’¡ ì—¬ëŸ¬ ê¸°ëŠ¥ì—ì„œ ë¬¸ì œê°€ ë°œê²¬ë˜ì–´ ìˆ˜ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.\n';
            }

            report += '\nğŸ“ ê¶Œì¥ ì‚¬í•­:\n';
            report += '-'.repeat(30) + '\n';
            
            if (!testResults.connection) {
                report += '- Supabase ì—°ê²° ì„¤ì • í™•ì¸\n';
            }
            if (!testResults.auth) {
                report += '- ì¸ì¦ ì„œë¹„ìŠ¤ ì„¤ì • ê²€í† \n';
            }
            if (!testResults.crud) {
                report += '- ë°ì´í„°ë² ì´ìŠ¤ ê¶Œí•œ ë° RLS ì •ì±… í™•ì¸\n';
            }
            if (!testResults.realtime) {
                report += '- Realtime ì„œë¹„ìŠ¤ í™œì„±í™” í™•ì¸\n';
            }
            if (!testResults.social) {
                report += '- OAuth í”„ë¡œë°”ì´ë” ì„¤ì • ê²€í† \n';
            }

            output.textContent = report;
        }

        // í—¬í¼ í•¨ìˆ˜ë“¤
        function loadSupabaseSDK() {
            return new Promise((resolve, reject) => {
                if (window.supabase) {
                    resolve();
                    return;
                }
                
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2';
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        async function createOrFindSite(supabase, siteName) {
            try {
                // ê¸°ì¡´ ì‚¬ì´íŠ¸ í™•ì¸
                const { data: existingSite, error: selectError } = await supabase
                    .from('sites')
                    .select('id, name')
                    .eq('name', siteName)
                    .eq('is_active', true)
                    .single();

                if (existingSite && !selectError) {
                    console.log('âœ… ê¸°ì¡´ ì‚¬ì´íŠ¸ ë°œê²¬:', existingSite.id);
                    return existingSite.id;
                }

                // ìƒˆ ì‚¬ì´íŠ¸ ìƒì„±
                console.log('ğŸ”§ ìƒˆ ì‚¬ì´íŠ¸ ìƒì„± ì¤‘:', siteName);
                const { data: newSite, error: insertError } = await supabase
                    .from('sites')
                    .insert([{
                        name: siteName,
                        domain: window.location.hostname,
                        description: `Production test site for ${siteName}`,
                        settings: {
                            allow_anonymous: true,
                            moderation_enabled: false,
                            max_comment_length: 2000,
                            theme: 'light',
                            language: 'ko'
                        }
                    }])
                    .select('id, name')
                    .single();

                if (newSite && !insertError) {
                    console.log('âœ… ìƒˆ ì‚¬ì´íŠ¸ ìƒì„± ì™„ë£Œ:', newSite.id);
                    return newSite.id;
                } else {
                    console.error('âŒ ì‚¬ì´íŠ¸ ìƒì„± ì‹¤íŒ¨:', insertError);
                    throw new Error(`Failed to create site: ${insertError?.message}`);
                }
                
            } catch (error) {
                console.error('âŒ ì‚¬ì´íŠ¸ ì²˜ë¦¬ ì‹¤íŒ¨:', error);
                throw error;
            }
        }

        // Production ìœ„ì ¯ ì„¤ì •
        async function setupProductionWidget() {
            const statusEl = document.getElementById('widget-status');
            const containerEl = document.getElementById('widget-container');
            
            try {
                statusEl.innerHTML = 'â³ Production ìœ„ì ¯ ì„¤ì • ì¤‘...';
                statusEl.style.background = '#fef3c7';
                
                // Supabase í´ë¼ì´ì–¸íŠ¸ ì§ì ‘ ìƒì„± (kommentio ì˜ì¡´ì„± ì œê±°)
                if (!window.supabase) {
                    statusEl.innerHTML = 'ğŸ“¦ Supabase SDK ë¡œë”© ì¤‘...';
                    await loadSupabaseSDK();
                }
                
                const supabase = window.supabase.createClient(
                    'https://nwjbtsjeikrwyqltkpqv.supabase.co',
                    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im53amJ0c2plaWtyd3lxbHRrcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk1NDA0MDUsImV4cCI6MjA2NTExNjQwNX0.UXNFgCrKfBHrcbenw94v9rD-sbGEE6ENDaF7h01EFPQ'
                );
                
                statusEl.innerHTML = 'ğŸ” ì‚¬ì´íŠ¸ UUID ìƒì„± ì¤‘...';
                
                // ì‹¤ì œ UUID ì‚¬ìš© (supabase-production-test)
                const siteUUID = '4250cc63-2c9a-47f9-a612-4a02ff7c15c0';
                statusEl.innerHTML = `âœ… ì‹¤ì œ ì‚¬ì´íŠ¸ UUID ì‚¬ìš©: ${siteUUID}`;
                
                // ê¸°ì¡´ ìœ„ì ¯ ì œê±°
                if (window.kommentio) {
                    // ê¸°ì¡´ Kommentio ì¸ìŠ¤í„´ìŠ¤ ì •ë¦¬
                    window.kommentio = null;
                }
                
                // ê¸°ì¡´ ìœ„ì ¯ HTML ì™„ì „ ì œê±°
                containerEl.innerHTML = '';
                
                statusEl.innerHTML = 'ğŸ”„ Production ëª¨ë“œ ìœ„ì ¯ ìƒì„± ì¤‘...';
                
                // ì ì‹œ ëŒ€ê¸° í›„ ìƒˆ ìœ„ì ¯ ìƒì„±
                setTimeout(() => {
                    // ìƒˆë¡œìš´ ìœ„ì ¯ HTML ìƒì„±
                    containerEl.innerHTML = `
                        <div 
                            data-kommentio
                            data-site-id="${siteUUID}"
                            data-page-url="/supabase-production-test"
                            data-theme="light"
                            data-language="ko"
                            data-supabase-url="https://nwjbtsjeikrwyqltkpqv.supabase.co"
                            data-supabase-key="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im53amJ0c2plaWtyd3lxbHRrcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk1NDA0MDUsImV4cCI6MjA2NTExNjQwNX0.UXNFgCrKfBHrcbenw94v9rD-sbGEE6ENDaF7h01EFPQ"
                        ></div>
                    `;
                    
                    // Kommentio ì¬ì´ˆê¸°í™” ê°•ì œ ì‹¤í–‰
                    if (window.Kommentio) {
                        const target = containerEl.querySelector('[data-kommentio]');
                        const options = {
                            siteId: target.dataset.siteId,
                            pageUrl: target.dataset.pageUrl || window.location.pathname,
                            theme: target.dataset.theme || 'auto',
                            language: target.dataset.language || 'ko',
                            allowAnonymous: target.dataset.allowAnonymous !== 'false',
                            supabaseUrl: target.dataset.supabaseUrl || null,
                            supabaseKey: target.dataset.supabaseKey || null,
                            claudeApiKey: target.dataset.claudeApiKey || null
                        };
                        
                        // ìƒˆ Kommentio ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
                        window.kommentio = new window.Kommentio(options);
                        
                        // ìƒì„± ì™„ë£Œ í™•ì¸
                        setTimeout(() => {
                            if (window.kommentio) {
                                statusEl.innerHTML = `
                                    âœ… Production ìœ„ì ¯ ì„¤ì • ì™„ë£Œ!<br>
                                    ğŸ†” ì‚¬ì´íŠ¸ UUID: <code>${siteUUID}</code><br>
                                    ğŸ“Š ëª¨ë“œ: ${window.kommentio.mockMode ? 'Mock (ì„¤ì • ì‹¤íŒ¨)' : 'Production'}<br>
                                    ğŸ¯ ìƒˆë¡œê³ ì¹¨ ì—†ì´ ë™ì  ìƒì„± ì™„ë£Œ!
                                `;
                                statusEl.style.background = window.kommentio.mockMode ? '#fef3c7' : '#d1fae5';
                            }
                        }, 1000);
                    }
                }, 500);
                
            } catch (error) {
                statusEl.innerHTML = `âŒ ìœ„ì ¯ ì„¤ì • ì‹¤íŒ¨: ${error.message}`;
                statusEl.style.background = '#fee2e2';
                console.error('Widget setup error:', error);
            }
        }

        // ìë™ í…ŒìŠ¤íŠ¸ ì‹œì‘
        window.addEventListener('load', () => {
            // ìœ„ì ¯ ë¡œë”© ìƒíƒœ ì—…ë°ì´íŠ¸
            const statusEl = document.getElementById('widget-status');
            
            const checkWidget = () => {
                if (window.kommentio) {
                    statusEl.innerHTML = `
                        âœ… Kommentio ìœ„ì ¯ ë¡œë“œ ì™„ë£Œ!<br>
                        ğŸ“Š ëª¨ë“œ: ${window.kommentio.mockMode ? 'Mock' : 'Production'}<br>
                        ğŸ¯ ì´ì œ ëª¨ë“  í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    `;
                    statusEl.style.background = '#d1fae5';
                    
                    // ìë™ìœ¼ë¡œ Supabase ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘
                    setTimeout(() => {
                        testSupabaseConnection();
                    }, 1000);
                } else {
                    statusEl.innerHTML = 'â³ Kommentio ìœ„ì ¯ ë¡œë”© ì¤‘...';
                    statusEl.style.background = '#fef3c7';
                    setTimeout(checkWidget, 500);
                }
            };
            
            // ìœ„ì ¯ ë¡œë”© í™•ì¸ ì‹œì‘
            setTimeout(checkWidget, 1000);
        });
    </script>
</body>
</html>