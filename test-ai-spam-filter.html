<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ìŠ¤íŒ¸ í•„í„°ë§ í…ŒìŠ¤íŠ¸ - Kommentio v0.2.1</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 2rem;
            background: #f9fafb;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .status {
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            font-weight: 500;
        }
        .success { background: #10b981; color: white; }
        .warning { background: #f59e0b; color: white; }
        .error { background: #ef4444; color: white; }
        .info { background: #3b82f6; color: white; }
        
        .test-section {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }
        
        .test-button {
            background: #7c3aed;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            margin-right: 1rem;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .test-button:hover {
            background: #6d28d9;
        }
        
        .test-button.danger {
            background: #dc2626;
        }
        
        .test-button.danger:hover {
            background: #b91c1c;
        }
        
        .test-button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        
        .log-container {
            background: #f3f4f6;
            border-radius: 6px;
            padding: 1rem;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.875rem;
            margin-top: 1rem;
        }
        
        .claude-config {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .test-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            margin-bottom: 1rem;
            font-size: 14px;
        }
        
        .spam-result {
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .spam-result.spam {
            border-color: #dc2626;
            background: #fef2f2;
        }
        
        .spam-result.clean {
            border-color: #16a34a;
            background: #f0fdf4;
        }
        
        .score-bar {
            width: 100%;
            height: 20px;
            background: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
            margin: 0.5rem 0;
        }
        
        .score-fill {
            height: 100%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        
        .preset-tests {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .preset-button {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 0.75rem;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
        }
        
        .preset-button:hover {
            background: #e5e7eb;
            transform: translateY(-1px);
        }
        
        .preset-button.spam {
            border-color: #dc2626;
            background: #fef2f2;
        }
        
        .preset-button.clean {
            border-color: #16a34a;
            background: #f0fdf4;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="status info">
            ğŸ¤– AI ìŠ¤íŒ¸ í•„í„°ë§ í…ŒìŠ¤íŠ¸ - Claude API ì‹¤ì œ ì—°ë™ ê²€ì¦
        </div>

        <!-- Claude API ì„¤ì • -->
        <div class="test-section">
            <h3>ğŸ”§ Claude API ì„¤ì •</h3>
            <div class="claude-config">
                <h4>âš™ï¸ API í‚¤ ì„¤ì •</h4>
                <p>Claude API í‚¤ë¥¼ ì…ë ¥í•˜ì—¬ ì‹¤ì œ AI ìŠ¤íŒ¸ í•„í„°ë§ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
                <input type="password" id="claude-api-key" class="test-input" 
                       placeholder="Claude API í‚¤ ì…ë ¥ (sk-ant-api03-...)" 
                       value="">
                <small>ğŸ’¡ API í‚¤ëŠ” ë¡œì»¬ì—ë§Œ ì €ì¥ë˜ë©° ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</small>
            </div>
            <div id="api-status" class="status warning">API í‚¤ í™•ì¸ ì¤‘...</div>
            <button class="test-button" onclick="saveApiKey()">API í‚¤ ì €ì¥</button>
            <button class="test-button" onclick="testApiConnection()">ì—°ê²° í…ŒìŠ¤íŠ¸</button>
            <button class="test-button danger" onclick="clearApiKey()">API í‚¤ ì‚­ì œ</button>
        </div>

        <div class="grid-2">
            <!-- ìˆ˜ë™ ìŠ¤íŒ¸ í…ŒìŠ¤íŠ¸ -->
            <div class="test-section">
                <h3>ğŸ“ ìˆ˜ë™ ìŠ¤íŒ¸ í…ŒìŠ¤íŠ¸</h3>
                <p>ì§ì ‘ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì—¬ AI ìŠ¤íŒ¸ í•„í„°ë§ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
                
                <textarea id="manual-test-input" class="test-input" rows="4" 
                          placeholder="í…ŒìŠ¤íŠ¸í•  ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...">ì•ˆë…•í•˜ì„¸ìš”! ì¢‹ì€ ê¸€ ì˜ ë´¤ìŠµë‹ˆë‹¤.</textarea>
                
                <button class="test-button" onclick="testManualSpam()">ìŠ¤íŒ¸ ê²€ì‚¬ ì‹¤í–‰</button>
                <button class="test-button" onclick="clearManualResult()">ê²°ê³¼ ì§€ìš°ê¸°</button>
                
                <div id="manual-result"></div>
            </div>

            <!-- í”„ë¦¬ì…‹ í…ŒìŠ¤íŠ¸ -->
            <div class="test-section">
                <h3>ğŸ¯ í”„ë¦¬ì…‹ í…ŒìŠ¤íŠ¸</h3>
                <p>ë¯¸ë¦¬ ì¤€ë¹„ëœ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¡œ AI ì„±ëŠ¥ì„ í™•ì¸í•©ë‹ˆë‹¤.</p>
                
                <div class="preset-tests">
                    <div class="preset-button clean" onclick="testPreset('ì •ìƒì ì¸ ëŒ“ê¸€ì…ë‹ˆë‹¤. ì¢‹ì€ ê¸€ ê°ì‚¬í•©ë‹ˆë‹¤!')">
                        <strong>âœ… ì •ìƒ ëŒ“ê¸€</strong><br>
                        <small>ì¼ë°˜ì ì¸ ê¸ì •ì  ëŒ“ê¸€</small>
                    </div>
                    
                    <div class="preset-button spam" onclick="testPreset('ì§€ê¸ˆ ë°”ë¡œ í´ë¦­í•˜ì„¸ìš”! ë¬´ë£Œ ë‹¤ìš´ë¡œë“œ: http://spam-site.com/download')">
                        <strong>âŒ ìŠ¤íŒ¸ ë§í¬</strong><br>
                        <small>ìƒì—…ì  ë§í¬ê°€ í¬í•¨ëœ ëŒ“ê¸€</small>
                    </div>
                    
                    <div class="preset-button spam" onclick="testPreset('ëˆì„ ë²Œê³  ì‹¶ë‹¤ë©´ ì´ê²ƒì„ í™•ì¸í•˜ì„¸ìš”! í•˜ë£¨ì— 100ë§Œì› ë²Œê¸°!')">
                        <strong>âŒ ê¸ˆì „ ìœ í˜¹</strong><br>
                        <small>ëˆë²Œì´ ê´€ë ¨ ìŠ¤íŒ¸</small>
                    </div>
                    
                    <div class="preset-button spam" onclick="testPreset('ë°”ì´ì•„ê·¸ë¼ í• ì¸ íŒë§¤! ì§€ê¸ˆ ì£¼ë¬¸í•˜ë©´ 50% í• ì¸!')">
                        <strong>âŒ ì•½ë¬¼ ê´‘ê³ </strong><br>
                        <small>ì˜ì•½í’ˆ ë¶ˆë²• íŒë§¤ ê´‘ê³ </small>
                    </div>
                    
                    <div class="preset-button clean" onclick="testPreset('ì´ ì£¼ì œì— ëŒ€í•´ ë‹¤ë¥¸ ì˜ê²¬ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. í† ë¡ í•´ë³´ì‹œì£ .')">
                        <strong>âœ… ê±´ì„¤ì  ì˜ê²¬</strong><br>
                        <small>ê±´ì „í•œ í† ë¡  ì œì•ˆ</small>
                    </div>
                    
                    <div class="preset-button spam" onclick="testPreset('ë°”ë³´ì•¼! ë„ˆ ê°™ì€ ë†ˆì€ ì—¬ê¸°ì„œ ë‚˜ê°€!')">
                        <strong>âŒ ìš•ì„¤/í˜ì˜¤</strong><br>
                        <small>ëª¨ìš•ì ì¸ ì–¸ì–´ ì‚¬ìš©</small>
                    </div>
                </div>
                
                <div id="preset-result" class="log-container"></div>
            </div>
        </div>

        <!-- ë°°ì¹˜ í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <h3>ğŸ”„ ë°°ì¹˜ í…ŒìŠ¤íŠ¸</h3>
            <p>ì—¬ëŸ¬ ëŒ“ê¸€ì„ í•œ ë²ˆì— í…ŒìŠ¤íŠ¸í•˜ì—¬ AI ì„±ëŠ¥ì„ ì¢…í•©ì ìœ¼ë¡œ í‰ê°€í•©ë‹ˆë‹¤.</p>
            
            <button class="test-button" onclick="runBatchTest()">ë°°ì¹˜ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
            <button class="test-button" onclick="exportResults()">ê²°ê³¼ ë‚´ë³´ë‚´ê¸°</button>
            <button class="test-button danger" onclick="clearBatchResults()">ê²°ê³¼ ì§€ìš°ê¸°</button>
            
            <div id="batch-progress" style="margin: 1rem 0;"></div>
            <div id="batch-summary" style="margin: 1rem 0;"></div>
            <div id="batch-results" class="log-container"></div>
        </div>

        <!-- ì‹¤ì œ ìœ„ì ¯ í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <h3>ğŸ“ ì‹¤ì œ ìœ„ì ¯ì—ì„œ ìŠ¤íŒ¸ í•„í„°ë§ í…ŒìŠ¤íŠ¸</h3>
            <p>Kommentio ìœ„ì ¯ì—ì„œ ì‹¤ì œë¡œ ëŒ“ê¸€ì„ ì‘ì„±í•˜ì—¬ AI ìŠ¤íŒ¸ í•„í„°ë§ì„ í™•ì¸í•©ë‹ˆë‹¤.</p>
            <p><strong>ì°¸ê³ :</strong> Claude API í‚¤ê°€ ì„¤ì •ë˜ì–´ì•¼ ì‹¤ì œ AI í•„í„°ë§ì´ ì‘ë™í•©ë‹ˆë‹¤.</p>
            
            <!-- ìœ„ì ¯ì— Claude API í‚¤ ì „ë‹¬ -->
            <div id="widget-container">
                <div 
                    data-kommentio
                    data-site-id="kommentio-test-site"
                    data-theme="light"
                    data-language="ko"
                    data-supabase-url="https://nwjbtsjeikrwyqltkpqv.supabase.co"
                    data-supabase-key="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im53amJ0c2plaWtyd3lxbHRrcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk1NDA0MDUsImV4cCI6MjA2NTExNjQwNX0.UXNFgCrKfBHrcbenw94v9rD-sbGEE6ENDaF7h01EFPQ"
                    data-claude-api-key=""
                    data-page-url="https://kommentio.com/ai-spam-test"
                ></div>
            </div>
        </div>
    </div>

    <!-- Kommentio ìœ„ì ¯ ë¡œë“œ -->
    <script src="./src/kommentio.js"></script>

    <script>
        let claudeApiKey = '';
        let testResults = [];

        // ë¡œê·¸ ì¶œë ¥ í•¨ìˆ˜
        function addLog(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const timestamp = new Date().toLocaleTimeString();
            const logClass = type === 'error' ? 'color: #ef4444;' : 
                            type === 'success' ? 'color: #10b981;' : 
                            type === 'warning' ? 'color: #f59e0b;' : 
                            type === 'spam' ? 'color: #dc2626; font-weight: bold;' : 
                            type === 'clean' ? 'color: #16a34a; font-weight: bold;' : 'color: #374151;';
            
            container.innerHTML += `<div style="${logClass}">[${timestamp}] ${message}</div>`;
            container.scrollTop = container.scrollHeight;
        }

        // API í‚¤ ì €ì¥
        function saveApiKey() {
            const key = document.getElementById('claude-api-key').value.trim();
            
            if (!key) {
                document.getElementById('api-status').className = 'status error';
                document.getElementById('api-status').textContent = 'âŒ API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                return;
            }
            
            if (!key.startsWith('sk-ant-api03-')) {
                document.getElementById('api-status').className = 'status warning';
                document.getElementById('api-status').textContent = 'âš ï¸ ì˜¬ë°”ë¥¸ Claude API í‚¤ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.';
                return;
            }
            
            claudeApiKey = key;
            localStorage.setItem('kommentio-claude-api-key', key);
            
            // ìœ„ì ¯ì—ë„ API í‚¤ ì„¤ì •
            const widgetElement = document.querySelector('[data-kommentio]');
            if (widgetElement) {
                widgetElement.setAttribute('data-claude-api-key', key);
            }
            
            document.getElementById('api-status').className = 'status success';
            document.getElementById('api-status').textContent = 'âœ… Claude API í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.';
        }

        // API ì—°ê²° í…ŒìŠ¤íŠ¸
        async function testApiConnection() {
            if (!claudeApiKey) {
                document.getElementById('api-status').className = 'status error';
                document.getElementById('api-status').textContent = 'âŒ ë¨¼ì € API í‚¤ë¥¼ ì €ì¥í•´ì£¼ì„¸ìš”.';
                return;
            }
            
            document.getElementById('api-status').className = 'status warning';
            document.getElementById('api-status').textContent = 'ğŸ”„ API ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...';
            
            try {
                const result = await checkSpamWithClaude('ì•ˆë…•í•˜ì„¸ìš”! ì—°ê²° í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤.');
                
                if (result.spam_score !== undefined) {
                    document.getElementById('api-status').className = 'status success';
                    document.getElementById('api-status').textContent = `âœ… Claude API ì—°ê²° ì„±ê³µ! (ìŠ¤íŒ¸ ì ìˆ˜: ${result.spam_score})`;
                } else {
                    throw new Error('Invalid response format');
                }
                
            } catch (error) {
                document.getElementById('api-status').className = 'status error';
                document.getElementById('api-status').textContent = `âŒ API ì—°ê²° ì‹¤íŒ¨: ${error.message}`;
            }
        }

        // API í‚¤ ì‚­ì œ
        function clearApiKey() {
            claudeApiKey = '';
            localStorage.removeItem('kommentio-claude-api-key');
            document.getElementById('claude-api-key').value = '';
            
            // ìœ„ì ¯ì—ì„œë„ API í‚¤ ì œê±°
            const widgetElement = document.querySelector('[data-kommentio]');
            if (widgetElement) {
                widgetElement.removeAttribute('data-claude-api-key');
            }
            
            document.getElementById('api-status').className = 'status warning';
            document.getElementById('api-status').textContent = 'âš ï¸ API í‚¤ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.';
        }

        // Claude API ìŠ¤íŒ¸ ê²€ì‚¬ (ìœ„ì ¯ê³¼ ë™ì¼í•œ ë¡œì§)
        async function checkSpamWithClaude(content) {
            if (!claudeApiKey) {
                throw new Error('Claude API key not provided');
            }

            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': claudeApiKey,
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: 'claude-3-haiku-20240307',
                        max_tokens: 100,
                        messages: [{
                            role: 'user',
                            content: `ë‹¤ìŒ ëŒ“ê¸€ì´ ìŠ¤íŒ¸ì¸ì§€ ë¶„ì„í•´ì£¼ì„¸ìš”. 0.0(ì •ìƒ)ì—ì„œ 1.0(ìŠ¤íŒ¸) ì‚¬ì´ì˜ ì ìˆ˜ì™€ ê°„ë‹¨í•œ ì´ìœ ë¥¼ JSON í˜•íƒœë¡œ ì‘ë‹µí•´ì£¼ì„¸ìš”:

ëŒ“ê¸€: "${content}"

ì‘ë‹µ í˜•ì‹:
{
  "spam_score": 0.8,
  "reason": "ìƒì—…ì  ë§í¬ í¬í•¨"
}`
                        }]
                    })
                });

                if (!response.ok) {
                    throw new Error(`Claude API í˜¸ì¶œ ì‹¤íŒ¨: ${response.status}`);
                }

                const result = await response.json();
                const analysis = JSON.parse(result.content[0].text);
                
                return {
                    spam_score: analysis.spam_score,
                    reason: analysis.reason,
                    is_spam: analysis.spam_score > 0.7
                };
            } catch (error) {
                console.error('Claude API ì˜¤ë¥˜:', error);
                throw error;
            }
        }

        // ìˆ˜ë™ ìŠ¤íŒ¸ í…ŒìŠ¤íŠ¸
        async function testManualSpam() {
            const content = document.getElementById('manual-test-input').value.trim();
            
            if (!content) {
                alert('í…ŒìŠ¤íŠ¸í•  ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!claudeApiKey) {
                alert('ë¨¼ì € Claude API í‚¤ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                const startTime = Date.now();
                const result = await checkSpamWithClaude(content);
                const duration = Date.now() - startTime;
                
                displaySpamResult('manual-result', content, result, duration);
                testResults.push({ content, result, duration, timestamp: new Date() });
                
            } catch (error) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'spam-result';
                errorDiv.innerHTML = `
                    <strong>âŒ ì˜¤ë¥˜ ë°œìƒ</strong><br>
                    <small>${error.message}</small>
                `;
                document.getElementById('manual-result').appendChild(errorDiv);
            }
        }

        // í”„ë¦¬ì…‹ í…ŒìŠ¤íŠ¸
        async function testPreset(content) {
            document.getElementById('manual-test-input').value = content;
            
            if (!claudeApiKey) {
                addLog('preset-result', 'âŒ Claude API í‚¤ë¥¼ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            addLog('preset-result', `ğŸ”„ í…ŒìŠ¤íŠ¸ ì¤‘: "${content.substring(0, 50)}..."`, 'info');
            
            try {
                const startTime = Date.now();
                const result = await checkSpamWithClaude(content);
                const duration = Date.now() - startTime;
                
                const status = result.is_spam ? 'spam' : 'clean';
                const icon = result.is_spam ? 'âŒ' : 'âœ…';
                
                addLog('preset-result', 
                    `${icon} ì ìˆ˜: ${result.spam_score.toFixed(2)} | ì´ìœ : ${result.reason} | ì‹œê°„: ${duration}ms`, 
                    status);
                
                testResults.push({ content, result, duration, timestamp: new Date() });
                
            } catch (error) {
                addLog('preset-result', `âŒ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // ìŠ¤íŒ¸ ê²°ê³¼ í‘œì‹œ
        function displaySpamResult(containerId, content, result, duration) {
            const container = document.getElementById(containerId);
            const resultDiv = document.createElement('div');
            resultDiv.className = `spam-result ${result.is_spam ? 'spam' : 'clean'}`;
            
            const scorePercent = Math.round(result.spam_score * 100);
            const scoreColor = result.spam_score < 0.3 ? '#16a34a' : 
                             result.spam_score < 0.7 ? '#f59e0b' : '#dc2626';
            
            resultDiv.innerHTML = `
                <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 0.5rem;">
                    <strong>${result.is_spam ? 'âŒ ìŠ¤íŒ¸ ê°ì§€' : 'âœ… ì •ìƒ ëŒ“ê¸€'}</strong>
                    <small>${duration}ms</small>
                </div>
                <div class="score-bar">
                    <div class="score-fill" style="width: ${scorePercent}%; background: ${scoreColor};">
                        ${scorePercent}%
                    </div>
                </div>
                <div style="margin-bottom: 0.5rem;">
                    <strong>ì´ìœ :</strong> ${result.reason}
                </div>
                <div style="font-size: 0.875rem; color: #6b7280;">
                    <strong>ë‚´ìš©:</strong> ${content}
                </div>
            `;
            
            container.appendChild(resultDiv);
        }

        // ë°°ì¹˜ í…ŒìŠ¤íŠ¸
        async function runBatchTest() {
            const testCases = [
                'ì•ˆë…•í•˜ì„¸ìš”! ì¢‹ì€ ê¸€ ì˜ ë´¤ìŠµë‹ˆë‹¤.',
                'ì´ ì£¼ì œì— ëŒ€í•´ ë” ìì„¸íˆ ì•Œê³  ì‹¶ì–´ìš”.',
                'ê°ì‚¬í•©ë‹ˆë‹¤. ë§ì€ ë„ì›€ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.',
                'ì§€ê¸ˆ ë°”ë¡œ í´ë¦­í•˜ì„¸ìš”! ë¬´ë£Œ ë‹¤ìš´ë¡œë“œ http://spam.com',
                'ëˆì„ ë²Œê³  ì‹¶ë‹¤ë©´ ì´ê²ƒì„ í™•ì¸í•˜ì„¸ìš”! í•˜ë£¨ 100ë§Œì›!',
                'ë°”ì´ì•„ê·¸ë¼ í• ì¸ íŒë§¤! 50% í• ì¸!',
                'ë°”ë³´ì•¼! ë„ˆ ê°™ì€ ë†ˆì€ ì—¬ê¸°ì„œ ë‚˜ê°€!',
                'ì´ ì˜ê²¬ì— ë™ì˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤ë§Œ, ì¡´ì¤‘í•©ë‹ˆë‹¤.',
                'ì¹´ì§€ë…¸ ê²Œì„ìœ¼ë¡œ ì‰½ê²Œ ëˆë²Œê¸°! ì§€ê¸ˆ ê°€ì…í•˜ì„¸ìš”!',
                'ì¢‹ì€ ì •ë³´ ê³µìœ í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.'
            ];
            
            if (!claudeApiKey) {
                alert('Claude API í‚¤ë¥¼ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            document.getElementById('batch-results').innerHTML = '';
            document.getElementById('batch-summary').innerHTML = '';
            
            let processed = 0;
            let spamCount = 0;
            let cleanCount = 0;
            let totalDuration = 0;
            
            for (const content of testCases) {
                document.getElementById('batch-progress').innerHTML = 
                    `ì§„í–‰ ìƒí™©: ${processed + 1}/${testCases.length} (${Math.round((processed + 1) / testCases.length * 100)}%)`;
                
                try {
                    const startTime = Date.now();
                    const result = await checkSpamWithClaude(content);
                    const duration = Date.now() - startTime;
                    
                    totalDuration += duration;
                    
                    if (result.is_spam) {
                        spamCount++;
                    } else {
                        cleanCount++;
                    }
                    
                    const status = result.is_spam ? 'spam' : 'clean';
                    const icon = result.is_spam ? 'âŒ' : 'âœ…';
                    
                    addLog('batch-results', 
                        `${icon} [${result.spam_score.toFixed(2)}] ${content} (${duration}ms)`, 
                        status);
                    
                    testResults.push({ content, result, duration, timestamp: new Date() });
                    
                } catch (error) {
                    addLog('batch-results', `âŒ ì˜¤ë¥˜: ${content} - ${error.message}`, 'error');
                }
                
                processed++;
                
                // API ì†ë„ ì œí•œ ê³ ë ¤í•˜ì—¬ ì ì‹œ ëŒ€ê¸°
                await new Promise(resolve => setTimeout(resolve, 200));
            }
            
            // ìš”ì•½ í‘œì‹œ
            const avgDuration = Math.round(totalDuration / processed);
            document.getElementById('batch-summary').innerHTML = `
                <div style="background: #f3f4f6; padding: 1rem; border-radius: 6px;">
                    <h4>ğŸ”„ ë°°ì¹˜ í…ŒìŠ¤íŠ¸ ì™„ë£Œ</h4>
                    <p><strong>ì²˜ë¦¬ëœ ëŒ“ê¸€:</strong> ${processed}ê°œ</p>
                    <p><strong>ìŠ¤íŒ¸ ê°ì§€:</strong> ${spamCount}ê°œ (${Math.round(spamCount/processed*100)}%)</p>
                    <p><strong>ì •ìƒ ëŒ“ê¸€:</strong> ${cleanCount}ê°œ (${Math.round(cleanCount/processed*100)}%)</p>
                    <p><strong>í‰ê·  ì²˜ë¦¬ ì‹œê°„:</strong> ${avgDuration}ms</p>
                    <p><strong>ì´ ì²˜ë¦¬ ì‹œê°„:</strong> ${Math.round(totalDuration/1000)}ì´ˆ</p>
                </div>
            `;
            
            document.getElementById('batch-progress').innerHTML = 'âœ… ë°°ì¹˜ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!';
        }

        // ê²°ê³¼ ë‚´ë³´ë‚´ê¸°
        function exportResults() {
            if (testResults.length === 0) {
                alert('ë‚´ë³´ë‚¼ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const csv = [
                ['ì‹œê°„', 'ë‚´ìš©', 'ìŠ¤íŒ¸ì ìˆ˜', 'ìŠ¤íŒ¸ì—¬ë¶€', 'ì´ìœ ', 'ì²˜ë¦¬ì‹œê°„(ms)'],
                ...testResults.map(r => [
                    r.timestamp.toISOString(),
                    `"${r.content.replace(/"/g, '""')}"`,
                    r.result.spam_score,
                    r.result.is_spam ? 'SPAM' : 'CLEAN',
                    `"${r.result.reason.replace(/"/g, '""')}"`,
                    r.duration
                ])
            ].map(row => row.join(',')).join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `kommentio-spam-test-${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        // ê²°ê³¼ ì§€ìš°ê¸° í•¨ìˆ˜ë“¤
        function clearManualResult() {
            document.getElementById('manual-result').innerHTML = '';
        }

        function clearBatchResults() {
            document.getElementById('batch-results').innerHTML = '';
            document.getElementById('batch-summary').innerHTML = '';
            document.getElementById('batch-progress').innerHTML = '';
            testResults = [];
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('load', () => {
            // ì €ì¥ëœ API í‚¤ ë¶ˆëŸ¬ì˜¤ê¸°
            const savedKey = localStorage.getItem('kommentio-claude-api-key');
            if (savedKey) {
                document.getElementById('claude-api-key').value = savedKey;
                claudeApiKey = savedKey;
                
                // ìœ„ì ¯ì—ë„ API í‚¤ ì„¤ì •
                const widgetElement = document.querySelector('[data-kommentio]');
                if (widgetElement) {
                    widgetElement.setAttribute('data-claude-api-key', savedKey);
                }
                
                document.getElementById('api-status').className = 'status success';
                document.getElementById('api-status').textContent = 'âœ… ì €ì¥ëœ Claude API í‚¤ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.';
            }
        });
    </script>
</body>
</html>